<!DOCTYPE html>
<html lang="es" data-theme="light" style="--primary-color: #02735E;">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Analytics - Centro de An√°lisis | Opsis Suite</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <script src="notifications-manager.js"></script>
  <style>
    :root {
      /* VERDI Color Palette */
      --verdi-dark: #022326;
      --verdi-mid: #034040;
      --verdi-accent: #035951;
      --verdi-light: #02735E;
      
      --primary-color: #02735E;
      --accent-color: #035951;
      --text-primary: #1e293b;
      --text-secondary: #475569;
      --bg-body: #fafafa;
      --bg-card: #ffffff;
      --border-color: #ebebeb;
      --surface-page-a: #fafafa;
      --surface-page-b: #f7f7f7;
      --surface-page-dark-a: #1b2538;
      --surface-page-dark-b: #151d2c;
      --table-header-bg: #fafafa;
    }

    [data-theme='dark'] {
      --text-primary: #f8fafc;
      --text-secondary: #b8c4dd;
      --bg-body: #0f172a;
      --bg-card: #0f1316;
      --border-color: rgba(255,255,255,0.04);
      --surface-page-dark-a: #2b2f33;
      --surface-page-dark-b: #0f1214;
      --surface-page-a: var(--surface-page-dark-a);
      --surface-page-b: var(--surface-page-dark-b);
      --table-header-bg: #0b1220;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Helvetica Neue', Helvetica, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-body);
      color: var(--text-primary);
      font-weight: 400;
    }

    @keyframes aire {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .app-shell {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .app-content {
      display: grid;
      grid-template-columns: 70px 1fr;
      flex: 1;
      transition: grid-template-columns 0.3s ease;
    }

    header {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 20px;
      background: var(--bg-card);
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0;
    }

    .logo-text {
      display: flex;
      flex-direction: column;
      line-height: 1.2;
    }

    .logo-title {
      font-size: 26px;
      font-weight: 700;
      color: #ffffff;
      text-transform: none;
      letter-spacing: -0.3px;
    }

    .module-tab {
      padding: 10px 28px;
      border-radius: 10px 10px 0 0;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.2s ease;
      background: rgba(2, 115, 94, 0.15);
      color: #64748b;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .module-tab:hover {
      background: rgba(2, 115, 94, 0.25) !important;
      color: #475569 !important;
    }

    .module-tab.active {
      background: white !important;
      color: #02735E !important;
    }

    aside {
      background: var(--bg-card);
      border-right: 1px solid var(--border-color);
      padding: 24px 0;
      position: sticky;
      top: 64px;
      height: calc(100vh - 64px);
      overflow-y: auto;
      overflow-x: hidden;
      transition: all 0.3s ease;
      width: 70px;
      z-index: 100;
    }

    aside:hover {
      width: 250px;
    }

    aside.collapsed {
      width: 70px;
    }

    .sidebar-item {
      padding: 14px 24px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text-secondary);
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
      text-decoration: none;
      white-space: nowrap;
    }

    aside:not(:hover) .sidebar-item {
      padding: 14px 22px;
      justify-content: center;
    }

    aside:not(:hover) .sidebar-item svg {
      margin: 0;
    }

    aside:not(:hover) .sidebar-item span {
      display: none;
    }

    aside:hover .sidebar-item span {
      display: inline;
    }

    .sidebar-item.active {
      color: var(--primary-color);
      border-left-color: var(--primary-color);
      background: rgba(2, 115, 94, 0.05);
    }

    .sidebar-item:hover {
      color: var(--primary-color);
      background: rgba(2, 115, 94, 0.05);
    }

    .sidebar-item svg {
      min-width: 20px;
      stroke-width: 2;
    }

    main {
      padding: 24px;
      overflow-y: auto;
    }

    .page-header {
      margin-bottom: 32px;
    }

    .page-title {
      font-size: 32px;
      font-weight: 900;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .page-subtitle {
      font-size: 16px;
      color: var(--text-secondary);
    }

    .analytics-card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border: 1px solid var(--border-color);
      margin-bottom: 24px;
    }

    .card {
      background: var(--bg-card);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
      border: 1px solid var(--border-color);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 2px solid var(--border-color);
    }

    .card-title {
      font-size: 20px;
      font-weight: 800;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
    }

    .grid-3 {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    .grid-4 {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 10px;
      border: none;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background: var(--verdi-accent);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(2, 115, 94, 0.3);
    }

    .btn-secondary,
    .btn-white {
      background: var(--bg-body);
      color: var(--text-primary);
      border: 2px solid var(--border-color);
    }

    .btn-secondary:hover,
    .btn-white:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    select, input[type="date"] {
      padding: 10px 14px;
      border-radius: 10px;
      border: 2px solid var(--border-color);
      background: var(--bg-card);
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    select:hover, input[type="date"]:hover {
      border-color: var(--primary-color);
    }

    select:focus, input[type="date"]:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(2, 115, 94, 0.1);
    }

    .stat-card {
      background: linear-gradient(135deg, #f0fdf4, #dcfce7);
      border-radius: 12px;
      padding: 20px;
      border-left: 4px solid #10b981;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 900;
      color: #065f46;
      margin-bottom: 8px;
    }

    .stat-label {
      font-size: 13px;
      color: #047857;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-change {
      font-size: 13px;
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .stat-change.positive {
      color: #059669;
    }

    .stat-change.negative {
      color: #dc2626;
    }

    .chart-container {
      position: relative;
      height: 320px;
      margin-top: 16px;
    }

    .top-project {
      padding: 16px;
      border-radius: 10px;
      margin-bottom: 12px;
      border-left: 4px solid #cbd5e1;
      transition: all 0.2s;
    }

    .top-project:first-child {
      background: linear-gradient(135deg, #f0fdf4, #dcfce7);
      border-left-color: #02735E;
    }

    .top-project:hover {
      transform: translateX(8px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .activity-filter-btn {
      padding: 8px 16px;
      border: 2px solid var(--border-color);
      background: var(--bg-card);
      color: var(--text-secondary);
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .activity-filter-btn:hover {
      border-color: var(--primary-color);
      color: var(--primary-color);
    }

    .activity-filter-btn.active {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }

    .quick-action {
      background: var(--bg-card);
      border: 2px solid var(--border-color);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .quick-action:hover {
      border-color: var(--primary-color);
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(2, 115, 94, 0.15);
    }

    .quick-action-icon {
      font-size: 36px;
      margin-bottom: 12px;
    }

    .quick-action-label {
      font-size: 14px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 6px;
    }

    .quick-action-kbd {
      font-size: 11px;
      padding: 4px 8px;
      background: var(--bg-body);
      border-radius: 6px;
      color: var(--text-secondary);
      font-family: monospace;
    }

    @media (max-width: 1024px) {
      .grid-2, .grid-3, .grid-4 {
        grid-template-columns: 1fr;
      }
      
      aside {
        width: 80px;
      }
      
      aside .sidebar-item span {
        display: none;
      }
      
      main {
        padding: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell" data-theme="light" data-accent="#02735E">
    <header style="background: linear-gradient(135deg, #02735E 0%, #035951 50%, #034040 100%); background-size: 200% 200%; animation: aire 8s ease infinite; padding: 0; display: flex; align-items: flex-end;">
      <div class="logo" aria-label="Opsis Suite" style="padding: 18px 32px;">
        <div class="logo-text">
          <div class="logo-title">Opsis Suite</div>
          <div id="company-name-header" style="font-size: 12px; font-weight: 500; color: rgba(255,255,255,0.85); margin-top: 2px;">CVE San Diego</div>
        </div>
      </div>
      
      <!-- Module Tabs -->
      <div class="module-tabs" id="module-tabs-container" style="display: flex; gap: 0;"></div>
    </header>
    
    <script>
    const MODULE_REGISTRY = {
        motorsync: { name: 'MotorSync', url: 'motorsync.html', order: 1, enabled: true },
        timesync: { name: 'TimeSync', url: '../timesync/timesync.html', order: 2, enabled: true }
    };
    
    function renderModuleTabs() {
        const container = document.getElementById('module-tabs-container');
        if (!container) return;
        
        const currentPath = window.location.pathname;
        const sortedModules = Object.entries(MODULE_REGISTRY)
            .filter(([_, module]) => module.enabled)
            .sort((a, b) => a[1].order - b[1].order);
        
        container.innerHTML = sortedModules.map(([key, module]) => {
            const isActive = (key === 'motorsync' && currentPath.includes('/motorsync/')) ||
                           currentPath.endsWith(module.url);
            return `<a href="${module.url}" class="module-tab ${isActive ? 'active' : ''}">${module.name}</a>`;
        }).join('');
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', renderModuleTabs);
    } else {
        renderModuleTabs();
    }
    </script>

    <div class="app-content">
    <aside id="sidebar">
      <div class="sidebar-item" onclick="window.location.href='motorsync.html'">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="7" height="9"></rect>
          <rect x="14" y="3" width="7" height="5"></rect>
          <rect x="14" y="12" width="7" height="9"></rect>
          <rect x="3" y="16" width="7" height="5"></rect>
        </svg>
        <span>Dashboard</span>
      </div>
      
      <a href="plansync.html" class="sidebar-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <span>PlanSync</span>
      </a>
      
      <a href="projectsync.html" class="sidebar-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="9" y1="3" x2="9" y2="21"></line>
        </svg>
        <span>ProjectSync</span>
      </a>

      <a href="threadsync-list.html" class="sidebar-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
        <span>ThreadSync</span>
      </a>

      <a href="howsync.html" class="sidebar-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="2"></circle>
          <path d="M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"></path>
        </svg>
        <span>HowSync</span>
      </a>

      <a href="analytics.html" class="sidebar-item active">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="20" x2="12" y2="10"></line>
          <line x1="18" y1="20" x2="18" y2="4"></line>
          <line x1="6" y1="20" x2="6" y2="16"></line>
        </svg>
        <span>Analytics</span>
      </a>

      <a href="clientsync.html" class="sidebar-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M22 21v-2a4 4 0 0 0-3-3.87m-3-12.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        <span>ClientSync</span>
      </a>

      <a href="management.html" class="sidebar-item">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="1" x2="12" y2="23"></line>
          <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
        <span>Management</span>
      </a>

      <div class="sidebar-item" onclick="setTimeout(() => { window.location.href='motorsync.html#settings'; }, 100);">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="3"></circle>
          <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3m15.4-6.4l-4.2 4.2m-7.1 0L2.6 5.6m18.8 12.8l-4.2-4.2m-7.1 0l-4.5 4.5"></path>
        </svg>
        <span>Configuraci√≥n</span>
      </div>
    </aside>

    <main id="main">
      <section class="page">

      <!-- ====== DASHBOARD ANALYTICS MEJORADO ====== -->
      <div class="analytics-card">
        <div class="card-header">
          <h2 class="card-title">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="20" x2="12" y2="10"></line>
              <line x1="18" y1="20" x2="18" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="16"></line>
            </svg>
            Tendencias de Proyectos
          </h2>
          <select id="chart-period">
            <option value="7">√öltimos 7 d√≠as</option>
            <option value="30" selected>√öltimos 30 d√≠as</option>
            <option value="90">√öltimos 90 d√≠as</option>
          </select>
        </div>

        <div class="grid-2">
          <div>
            <div class="chart-container">
              <canvas id="projects-trend-chart"></canvas>
            </div>
          </div>

          <div>
            <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 16px; color: var(--text-primary);">Comparativa Mensual</h3>
            <div class="grid-2" style="margin-bottom: 24px;">
              <div class="stat-card">
                <div class="stat-value" id="current-month-value">24</div>
                <div class="stat-label">Mes Actual</div>
              </div>
              <div class="stat-card" style="background: linear-gradient(135deg, #f3f4f6, #e5e7eb); border-left-color: #6b7280;">
                <div class="stat-value" style="color: #374151;" id="previous-month-value">18</div>
                <div class="stat-label" style="color: #4b5563;">Mes Anterior</div>
              </div>
            </div>
            <div style="text-align: center; padding: 16px; background: linear-gradient(135deg, #f0fdfa, #dbeafe); border-radius: 12px;">
              <div style="font-size: 14px; color: #02735E; font-weight: 600; margin-bottom: 4px;">Crecimiento</div>
              <div style="font-size: 36px; font-weight: 900; color: #02735E;" id="growth-percentage">+33%</div>
            </div>
          </div>
        </div>

        <div class="grid-2" style="margin-top: 32px;">
          <div>
            <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 16px; color: var(--text-primary);">Top 5 Proyectos Rentables</h3>
            <div id="top-projects-list"></div>
          </div>

          <div>
            <h3 style="font-size: 16px; font-weight: 700; margin-bottom: 16px; color: var(--text-primary);">Mapa de Calor Semanal</h3>
            <div id="heatmap-container"></div>
          </div>
        </div>
      </div>

      <!-- ====== SISTEMA DE REPORTES ====== -->
      <div class="analytics-card" style="background: linear-gradient(135deg, #f0fdfa, #ccfbf1);">
        <div class="card-header">
          <h2 class="card-title" style="color: #02735E;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
              <line x1="16" y1="13" x2="8" y2="13"></line>
              <line x1="16" y1="17" x2="8" y2="17"></line>
              <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            Sistema de Reportes
          </h2>
        </div>

        <div class="grid-4" style="margin-bottom: 20px;">
          <div>
            <label style="display: block; font-size: 12px; font-weight: 700; color: #02735E; margin-bottom: 6px; text-transform: uppercase;">
              Tipo de Reporte
              <span title="Selecciona el tipo de an√°lisis que deseas generar" style="cursor: help; opacity: 0.7; font-size: 14px; margin-left: 4px;">‚ÑπÔ∏è</span>
            </label>
            <select id="report-type" style="width: 100%;" title="Desempe√±o: M√©tricas generales | Proyectos: An√°lisis de proyectos | Ingresos: An√°lisis financiero | Equipo: Rendimiento del personal">
              <option value="performance">Desempe√±o - M√©tricas generales</option>
              <option value="projects">Proyectos - Pipeline y status</option>
              <option value="revenue">Ingresos - An√°lisis financiero</option>
              <option value="team">Equipo - Rendimiento del personal</option>
            </select>
          </div>

          <div>
            <label style="display: block; font-size: 12px; font-weight: 700; color: #02735E; margin-bottom: 6px; text-transform: uppercase;">
              Fecha Inicio
              <span title="Fecha de inicio del per√≠odo a analizar" style="cursor: help; opacity: 0.7; font-size: 14px; margin-left: 4px;">‚ÑπÔ∏è</span>
            </label>
            <input type="date" id="report-start-date" value="2025-11-01" style="width: 100%;" title="Selecciona la fecha de inicio del reporte">
          </div>

          <div>
            <label style="display: block; font-size: 12px; font-weight: 700; color: #02735E; margin-bottom: 6px; text-transform: uppercase;">
              Fecha Fin
              <span title="Fecha de fin del per√≠odo a analizar" style="cursor: help; opacity: 0.7; font-size: 14px; margin-left: 4px;">‚ÑπÔ∏è</span>
            </label>
            <input type="date" id="report-end-date" value="2025-11-29" style="width: 100%;" title="Selecciona la fecha de fin del reporte">
          </div>

          <div>
            <label style="display: block; font-size: 12px; font-weight: 700; color: #02735E; margin-bottom: 6px; text-transform: uppercase;">
              Formato
              <span title="Formato de exportaci√≥n del reporte" style="cursor: help; opacity: 0.7; font-size: 14px; margin-left: 4px;">‚ÑπÔ∏è</span>
            </label>
            <select id="report-format" style="width: 100%;" title="PDF: Reporte profesional con gr√°ficas | Excel/CSV: Datos para an√°lisis">
              <option value="pdf">PDF - Reporte profesional</option>
              <option value="excel">Excel - Para an√°lisis</option>
              <option value="csv">CSV - Datos sin formato</option>
            </select>
          </div>
        </div>

        <div style="display: flex; gap: 12px;">
          <button class="btn btn-primary" onclick="generateReport()" title="Genera y descarga el reporte con las opciones seleccionadas">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Generar Reporte
          </button>
          <button class="btn btn-secondary" onclick="scheduleReport()" title="Programa reportes autom√°ticos diarios, semanales o mensuales">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            Programar Reporte
          </button>
        </div>
        
        <!-- Texto de ayuda -->
        <div style="margin-top: 16px; padding: 12px; background: #f0fdfa; border-left: 3px solid #0dcaf0; border-radius: 4px; font-size: 13px; color: #02735E;">
          <strong>üí° Tip:</strong> Los reportes PDF incluyen gr√°ficas y resumen ejecutivo. Para an√°lisis detallado usa Excel/CSV.
        </div>
      </div>

      <!-- ====== CENTRO DE ACTIVIDAD ====== -->
      <div class="analytics-card">
        <div class="card-header">
          <h2 class="card-title">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
            Centro de Actividad
          </h2>
          <div style="display: flex; gap: 8px;">
            <button class="activity-filter-btn active" data-filter="all" onclick="filterActivity('all')">Todas</button>
            <button class="activity-filter-btn" data-filter="projects" onclick="filterActivity('projects')">Proyectos</button>
            <button class="activity-filter-btn" data-filter="quotes" onclick="filterActivity('quotes')">Cotizaciones</button>
            <button class="activity-filter-btn" data-filter="team" onclick="filterActivity('team')">Equipo</button>
          </div>
        </div>

        <div id="activity-feed" style="max-height: 500px; overflow-y: auto;"></div>
      </div>

      <!-- ====== WIDGET DE CLIMA & CALENDARIO ====== -->
      <div class="grid-2">
        <div class="analytics-card" style="background: linear-gradient(135deg, #cffafe, #a5f3fc);">
          <div class="card-header">
            <h2 class="card-title" style="color: #06b6d4;">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="5"></circle>
                <line x1="12" y1="1" x2="12" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="23"></line>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                <line x1="1" y1="12" x2="3" y2="12"></line>
                <line x1="21" y1="12" x2="23" y2="12"></line>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
              </svg>
              Clima
            </h2>
          </div>

          <div style="text-align: center; margin-bottom: 20px;">
            <div style="font-size: 16px; color: #02735E; font-weight: 600; margin-bottom: 8px;">üìç M√©xico, CDMX</div>
            <div style="font-size: 72px; margin: 20px 0;">‚òÄÔ∏è</div>
            <div style="font-size: 48px; font-weight: 900; color: #02735E; margin-bottom: 12px;" id="current-temp">24¬∞C</div>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-top: 20px;">
              <div style="background: rgba(255,255,255,0.5); padding: 12px; border-radius: 10px;">
                <div style="font-size: 11px; color: #02735E; font-weight: 600;">SENSACI√ìN</div>
                <div style="font-size: 18px; font-weight: 800; color: #02735E;">26¬∞C</div>
              </div>
              <div style="background: rgba(255,255,255,0.5); padding: 12px; border-radius: 10px;">
                <div style="font-size: 11px; color: #02735E; font-weight: 600;">HUMEDAD</div>
                <div style="font-size: 18px; font-weight: 800; color: #02735E;">45%</div>
              </div>
              <div style="background: rgba(255,255,255,0.5); padding: 12px; border-radius: 10px;">
                <div style="font-size: 11px; color: #02735E; font-weight: 600;">VIENTO</div>
                <div style="font-size: 18px; font-weight: 800; color: #02735E;">12 km/h</div>
              </div>
            </div>
            <div style="margin-top: 16px; font-size: 14px; color: #02735E; font-weight: 600;">‚ú® Condiciones ideales para trabajo en campo</div>
          </div>
        </div>

        <div class="analytics-card">
          <div class="card-header">
            <h2 class="card-title">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              Agenda de Hoy
            </h2>
            <button class="btn btn-secondary" onclick="viewFullCalendar()">Ver Calendario</button>
          </div>

          <div style="text-align: center; margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, #f0fdf4, #dcfce7); border-radius: 12px;">
            <div style="font-size: 14px; color: #065f46; font-weight: 600; margin-bottom: 4px;">HOY</div>
            <div style="font-size: 24px; font-weight: 900; color: #064e3b;" id="today-date">29 de noviembre de 2025</div>
          </div>

          <div id="today-appointments" style="display: flex; flex-direction: column; gap: 12px;"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================================================================
    // ANALYTICS PAGE - COMPLETE FUNCTIONALITY
    // ============================================================================

    let projectsChart = null;

    // ====== FEATURE 1: DASHBOARD ANALYTICS MEJORADO ======
    function initProjectsTrendChart(days = 30) {
      const ctx = document.getElementById('projects-trend-chart');
      if (!ctx) return;

      const labels = Array.from({length: days}, (_, i) => {
        const d = new Date();
        d.setDate(d.getDate() - (days - 1 - i));
        return d.toLocaleDateString('es-MX', { day: 'numeric', month: 'short' });
      });

      const data = Array.from({length: days}, () => Math.floor(Math.random() * 8) + 2);

      if (projectsChart) {
        projectsChart.destroy();
      }

      projectsChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Proyectos Completados',
            data: data,
            borderColor: '#02735E',
            backgroundColor: 'rgba(2, 115, 94, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointRadius: 4,
            pointHoverRadius: 6,
            pointBackgroundColor: '#02735E',
            pointBorderColor: '#fff',
            pointBorderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              padding: 12,
              titleFont: { size: 14, weight: 'bold' },
              bodyFont: { size: 13 },
              borderColor: '#02735E',
              borderWidth: 2
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                stepSize: 2,
                font: { size: 11 }
              },
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              }
            },
            x: {
              ticks: {
                maxRotation: 45,
                minRotation: 45,
                font: { size: 10 }
              },
              grid: {
                display: false
              }
            }
          }
        }
      });
    }

    function initTopProjects() {
      const container = document.getElementById('top-projects-list');
      if (!container) return;

      const topProjects = [
        { name: 'Instalaci√≥n Residencial Premium', client: 'Casa Garc√≠a', revenue: 125000, status: 'completed' },
        { name: 'Proyecto Comercial Plaza Norte', client: 'Grupo Inmobiliario', revenue: 98500, status: 'completed' },
        { name: 'Mantenimiento Edificio Corporativo', client: 'TechCorp', revenue: 87200, status: 'completed' },
        { name: 'Remodelaci√≥n Oficinas Centro', client: 'Bufete Legal', revenue: 76300, status: 'completed' },
        { name: 'Sistema Integral Condominio', client: 'Vista Hermosa', revenue: 68900, status: 'completed' }
      ];

      container.innerHTML = topProjects.map((project, index) => `
        <div class="top-project" style="background: ${index === 0 ? 'linear-gradient(135deg, #f0fdf4, #dcfce7)' : 'var(--bg-body)'};">
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
            <div style="flex: 1;">
              <div style="font-weight: 700; color: var(--text-primary); margin-bottom: 4px; display: flex; align-items: center; gap: 8px;">
                ${index === 0 ? 'üèÜ' : `#${index + 1}`} ${project.name}
              </div>
              <div style="font-size: 12px; color: var(--text-secondary);">Cliente: ${project.client}</div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 20px; font-weight: 800; color: #10b981;">$${project.revenue.toLocaleString('es-MX')}</div>
              <div style="font-size: 11px; color: #047857; text-transform: uppercase; font-weight: 600;">MXN</div>
            </div>
          </div>
          <div style="height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden;">
            <div style="height: 100%; background: linear-gradient(90deg, #10b981, #059669); width: ${Math.max(50, (project.revenue / 125000) * 100)}%; transition: width 0.3s;"></div>
          </div>
        </div>
      `).join('');
    }

    function initHeatmap() {
      const container = document.getElementById('heatmap-container');
      if (!container) return;

      const days = ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'];
      const hours = ['9AM', '12PM', '3PM', '6PM'];
      
      const activityData = days.map(() => 
        hours.map(() => Math.floor(Math.random() * 100))
      );

      let html = '<div style="display: grid; grid-template-columns: 60px repeat(4, 1fr); gap: 8px;">';
      
      html += '<div></div>';
      hours.forEach(hour => {
        html += `<div style="text-align: center; font-size: 11px; color: var(--text-secondary); font-weight: 600;">${hour}</div>`;
      });
      
      days.forEach((day, dayIndex) => {
        html += `<div style="display: flex; align-items: center; font-size: 12px; color: var(--text-secondary); font-weight: 600;">${day}</div>`;
        activityData[dayIndex].forEach(activity => {
          const intensity = activity / 100;
          const color = intensity > 0.7 ? '#10b981' : 
                       intensity > 0.4 ? '#34d399' : 
                       intensity > 0.2 ? '#6ee7b7' : '#d1fae5';
          html += `
            <div style="background: ${color}; height: 40px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; color: ${intensity > 0.4 ? 'white' : '#065f46'}; cursor: pointer; transition: transform 0.2s;" 
                 onmouseover="this.style.transform='scale(1.05)'" 
                 onmouseout="this.style.transform='scale(1)'"
                 title="${activity}% actividad">
              ${activity > 50 ? activity : ''}
            </div>
          `;
        });
      });
      
      html += '</div>';
      html += '<div style="display: flex; align-items: center; gap: 12px; margin-top: 16px; justify-content: center; font-size: 11px; color: var(--text-secondary);">';
      html += '<span>Menos</span>';
      html += '<div style="display: flex; gap: 4px;">';
      ['#d1fae5', '#6ee7b7', '#34d399', '#10b981'].forEach(color => {
        html += `<div style="width: 16px; height: 16px; background: ${color}; border-radius: 3px;"></div>`;
      });
      html += '</div>';
      html += '<span>M√°s</span>';
      html += '</div>';
      
      container.innerHTML = html;
    }

    // ====== FEATURE 2: SISTEMA DE REPORTES ======

    // ====== FEATURE 3: CENTRO DE ACTIVIDAD ======
    function initActivityFeed() {
      const container = document.getElementById('activity-feed');
      if (!container) return;

      const activities = [
        { type: 'projects', icon: '‚úÖ', user: 'Juan P√©rez', action: 'complet√≥', target: 'Proyecto #PRJ-2024-042', time: '15 min', color: '#10b981' },
        { type: 'quotes', icon: 'üí∞', user: 'Mar√≠a L√≥pez', action: 'cre√≥', target: 'Cotizaci√≥n #COT-2024-156', time: '45 min', color: '#0dcaf0' },
        { type: 'team', icon: 'üë§', user: 'Carlos Ruiz', action: 'se uni√≥ al equipo', target: 'Operaciones', time: '1 hora', color: '#20c997' },
        { type: 'projects', icon: 'üìã', user: 'Ana Mart√≠nez', action: 'actualiz√≥', target: 'Proyecto #PRJ-2024-038', time: '2 horas', color: '#10b981' },
        { type: 'quotes', icon: '‚úçÔ∏è', user: 'Luis Gonz√°lez', action: 'envi√≥', target: 'Cotizaci√≥n #COT-2024-157', time: '3 horas', color: '#0dcaf0' },
        { type: 'team', icon: '‚è∞', user: 'Rosa Hern√°ndez', action: 'registr√≥', target: '8 horas de trabajo', time: '4 horas', color: '#20c997' },
        { type: 'projects', icon: 'üöÄ', user: 'Pedro S√°nchez', action: 'inici√≥', target: 'Proyecto #PRJ-2024-043', time: '5 horas', color: '#10b981' }
      ];

      renderActivityFeed(activities);
      window.allActivities = activities;
    }

    function renderActivityFeed(activities) {
      const container = document.getElementById('activity-feed');
      if (!container) return;

      if (activities.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">No hay actividades que coincidan con el filtro</div>';
        return;
      }

      container.innerHTML = activities.map(activity => `
        <div style="display: flex; gap: 16px; padding: 16px; border-left: 3px solid ${activity.color}; background: var(--bg-body); border-radius: 8px; margin-bottom: 12px; transition: all 0.2s;" 
             onmouseover="this.style.transform='translateX(8px)'; this.style.background='var(--bg-card)'" 
             onmouseout="this.style.transform='translateX(0)'; this.style.background='var(--bg-body)'">
          <div style="font-size: 28px;">${activity.icon}</div>
          <div style="flex: 1;">
            <div style="font-size: 14px; color: var(--text-primary); margin-bottom: 4px;">
              <strong>${activity.user}</strong> ${activity.action} <strong>${activity.target}</strong>
            </div>
            <div style="font-size: 12px; color: var(--text-secondary);">Hace ${activity.time}</div>
          </div>
        </div>
      `).join('');
    }

    function filterActivity(filter) {
      document.querySelectorAll('.activity-filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.filter === filter);
      });

      const allActivities = window.allActivities || [];
      const filtered = filter === 'all' ? allActivities : allActivities.filter(a => a.type === filter);
      renderActivityFeed(filtered);
    }

    // ====== FEATURE 4: QUICK ACTIONS PANEL ======
    function quickAction(action) {
      const actions = {
        'new-project': 'üìÅ Crear Nuevo Proyecto\n\nRedirigiendo a formulario...',
        'register-time': '‚è∞ Registrar Tiempo\n\nAbriendo TimeSync...',
        'new-quote': 'üí∞ Nueva Cotizaci√≥n\n\nAbriendo formulario de cotizaci√≥n...',
        'search': 'üîç B√∫squeda Global\n\nUsa Ctrl/Cmd + K para buscar en todo el sistema'
      };

      alert(actions[action] || 'Acci√≥n no disponible');
      console.log(`‚ö° Quick Action: ${action}`);
    }

    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey)) {
        switch(e.key.toLowerCase()) {
          case 'n':
            e.preventDefault();
            quickAction('new-project');
            break;
          case 't':
            e.preventDefault();
            quickAction('register-time');
            break;
          case 'q':
            e.preventDefault();
            quickAction('new-quote');
            break;
          case 'k':
            e.preventDefault();
            quickAction('search');
            break;
        }
      }
    });

    // ====== FEATURE 5: WIDGET DE CLIMA & CALENDARIO ======
    function initTodayAppointments() {
      const container = document.getElementById('today-appointments');
      if (!container) return;

      const appointments = [
        { time: '09:00 AM', title: 'Inspecci√≥n Sitio', client: 'Casa Garc√≠a', location: 'Polanco, CDMX', type: 'visit' },
        { time: '11:30 AM', title: 'Reuni√≥n con Cliente', client: 'Grupo Inmobiliario', location: 'Oficina', type: 'meeting' },
        { time: '02:00 PM', title: 'Instalaci√≥n Programada', client: 'TechCorp', location: 'Santa Fe', type: 'work' },
        { time: '04:30 PM', title: 'Seguimiento Proyecto', client: 'Bufete Legal', location: 'Llamada', type: 'call' }
      ];

      const typeIcons = {
        visit: 'üè†',
        meeting: 'üë•',
        work: 'üîß',
        call: 'üìû'
      };

      const typeColors = {
        visit: '#0dcaf0',
        meeting: '#06b6d4',
        work: '#10b981',
        call: '#02735E'
      };

      container.innerHTML = appointments.map(apt => `
        <div style="padding: 12px; background: var(--bg-body); border-left: 4px solid ${typeColors[apt.type]}; border-radius: 8px; transition: all 0.2s; cursor: pointer;" 
             onmouseover="this.style.transform='translateX(4px)'; this.style.boxShadow='0 2px 8px rgba(0,0,0,0.1)'" 
             onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='none'">
          <div style="display: flex; align-items: start; gap: 12px;">
            <div style="font-size: 24px;">${typeIcons[apt.type]}</div>
            <div style="flex: 1;">
              <div style="font-size: 13px; color: ${typeColors[apt.type]}; font-weight: 700; margin-bottom: 4px;">${apt.time}</div>
              <div style="font-weight: 600; color: var(--text-primary); margin-bottom: 2px;">${apt.title}</div>
              <div style="font-size: 12px; color: var(--text-secondary);">${apt.client}</div>
              <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">üìç ${apt.location}</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function viewFullCalendar() {
      alert('üìÖ Calendario Completo\n\nAbriendo vista de calendario mensual con todas las citas y eventos programados.\n\nFuncionalidad en desarrollo.');
    }

    function updateTodayDate() {
      const dateEl = document.getElementById('today-date');
      if (dateEl) {
        const today = new Date();
        const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
        dateEl.textContent = today.toLocaleDateString('es-MX', options);
      }
    }

    // ====== SISTEMA DE GENERACI√ìN DE REPORTES ======
    function generateReport() {
      const reportType = document.getElementById('report-type').value;
      const startDate = document.getElementById('report-start-date').value;
      const endDate = document.getElementById('report-end-date').value;
      const format = document.getElementById('report-format').value;

      console.log('üìä Generando reporte...', { reportType, startDate, endDate, format });

      // Validaci√≥n de fechas
      if (!startDate || !endDate) {
        showNotification('Error', 'Por favor selecciona las fechas del reporte', 'error');
        return;
      }

      // Validar que fecha fin no sea antes de fecha inicio
      if (new Date(endDate) < new Date(startDate)) {
        showNotification('Error', 'La fecha de fin no puede ser anterior a la fecha de inicio', 'error');
        return;
      }

      // Mostrar loading state
      const generateBtn = document.querySelector('button[onclick*="generateReport"]');
      if (generateBtn) {
        const originalText = generateBtn.innerHTML;
        generateBtn.innerHTML = '<span style="display: inline-flex; align-items: center;"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="animation: spin 1s linear infinite; margin-right: 8px;"><circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="2" stroke-dasharray="9 3" opacity="0.5"/></svg> Generando...</span>';
        generateBtn.disabled = true;

        setTimeout(() => {
          try {
            if (format === 'pdf') {
              generatePDFReport(reportType, startDate, endDate);
            } else if (format === 'excel') {
              generateExcelReport(reportType, startDate, endDate);
            } else if (format === 'csv') {
              generateCSVReport(reportType, startDate, endDate);
            }
            showNotification('√âxito', `Reporte ${reportType} generado correctamente en formato ${format.toUpperCase()}`, 'success');
          } catch (error) {
            console.error('Error al generar reporte:', error);
            showNotification('Error', 'Hubo un problema al generar el reporte', 'error');
          } finally {
            // Restaurar bot√≥n
            generateBtn.innerHTML = originalText;
            generateBtn.disabled = false;
          }
        }, 300);
      }
    }

    function generatePDFReport(type, start, end) {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Header
      doc.setFillColor(2, 115, 94);
      doc.rect(0, 0, 210, 40, 'F');
      
      doc.setTextColor(255, 255, 255);
      doc.setFontSize(24);
      doc.setFont(undefined, 'bold');
      doc.text('Opsis Suite', 15, 20);
      
      doc.setFontSize(12);
      doc.setFont(undefined, 'normal');
      doc.text('CVE San Diego', 15, 28);

      // Report Title
      doc.setTextColor(0, 0, 0);
      doc.setFontSize(18);
      doc.setFont(undefined, 'bold');
      const reportTitles = {
        performance: 'Reporte de Desempe√±o',
        projects: 'Reporte de Proyectos',
        revenue: 'Reporte de Ingresos',
        team: 'Reporte de Equipo'
      };
      doc.text(reportTitles[type] || 'Reporte General', 15, 55);

      // Period
      doc.setFontSize(10);
      doc.setFont(undefined, 'normal');
      doc.setTextColor(100, 100, 100);
      doc.text(`Per√≠odo: ${start} al ${end}`, 15, 62);
      doc.text(`Generado: ${new Date().toLocaleDateString('es-MX')}`, 15, 68);

      // Sample Data Table
      const tableData = generateReportData(type);
      
      doc.autoTable({
        startY: 75,
        head: [tableData.headers],
        body: tableData.rows,
        theme: 'striped',
        headStyles: { fillColor: [2, 115, 94], textColor: 255, fontStyle: 'bold' },
        styles: { fontSize: 9, cellPadding: 5 },
        alternateRowStyles: { fillColor: [245, 247, 250] }
      });

      // Summary
      const finalY = doc.lastAutoTable.finalY + 15;
      doc.setFontSize(12);
      doc.setFont(undefined, 'bold');
      doc.text('Resumen Ejecutivo', 15, finalY);
      
      doc.setFontSize(10);
      doc.setFont(undefined, 'normal');
      const summary = generateSummary(type, tableData);
      summary.forEach((line, i) => {
        doc.text(line, 15, finalY + 8 + (i * 6));
      });

      // Save
      const filename = `reporte_${type}_${new Date().getTime()}.pdf`;
      doc.save(filename);
      
      showNotification('‚úÖ Reporte generado exitosamente', `Archivo: ${filename}`, 'success');
    }

    function generateExcelReport(type, start, end) {
      const data = generateReportData(type);
      
      // Create CSV content (Excel can open CSV)
      let csv = data.headers.join(',') + '\n';
      data.rows.forEach(row => {
        csv += row.join(',') + '\n';
      });

      // Download
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `reporte_${type}_${new Date().getTime()}.csv`);
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);

      showNotification('‚úÖ Reporte Excel generado', 'Archivo CSV compatible con Excel', 'success');
    }

    function generateCSVReport(type, start, end) {
      generateExcelReport(type, start, end); // Same logic for CSV
    }

    function generateReportData(type) {
      const templates = {
        performance: {
          headers: ['M√©trica', 'Valor Actual', 'Objetivo', 'Variaci√≥n', 'Estado'],
          rows: [
            ['Proyectos Completados', '24', '20', '+20%', '‚úÖ Superado'],
            ['Satisfacci√≥n Cliente', '4.8/5', '4.5/5', '+6.7%', '‚úÖ Excelente'],
            ['Tiempo Promedio', '12 d√≠as', '15 d√≠as', '-20%', '‚úÖ Mejorado'],
            ['Rentabilidad', '32%', '28%', '+14.3%', '‚úÖ Superado'],
            ['Retrabajo', '3%', '5%', '-40%', '‚úÖ Reducido']
          ]
        },
        projects: {
          headers: ['Proyecto', 'Cliente', 'Estado', 'Progreso', 'Fecha Entrega'],
          rows: [
            ['Instalaci√≥n HVAC', 'Casa Garc√≠a', 'En Proceso', '75%', '2025-12-15'],
            ['Remodelaci√≥n Oficina', 'TechCorp', 'Completado', '100%', '2025-11-20'],
            ['Sistema El√©ctrico', 'Edificio Central', 'En Proceso', '45%', '2025-12-30'],
            ['Plomer√≠a Integral', 'Residencial Sur', 'Planeaci√≥n', '15%', '2026-01-10'],
            ['Mantenimiento', 'Grupo Inmobiliario', 'En Proceso', '60%', '2025-12-10']
          ]
        },
        revenue: {
          headers: ['Concepto', 'Noviembre', 'Octubre', 'Variaci√≥n', 'Acumulado'],
          rows: [
            ['Ingresos Totales', '$450,000', '$380,000', '+18.4%', '$4,200,000'],
            ['Proyectos Nuevos', '$280,000', '$220,000', '+27.3%', '$2,500,000'],
            ['Mantenimiento', '$120,000', '$115,000', '+4.3%', '$1,100,000'],
            ['Consultor√≠a', '$50,000', '$45,000', '+11.1%', '$600,000'],
            ['Costos', '$270,000', '$240,000', '+12.5%', '$2,520,000']
          ]
        },
        team: {
          headers: ['Miembro', 'Rol', 'Proyectos Activos', 'Horas/Semana', 'Rendimiento'],
          rows: [
            ['Juan P√©rez', 'Project Manager', '3', '40', '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'],
            ['Mar√≠a L√≥pez', 'T√©cnico Senior', '5', '42', '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'],
            ['Carlos Ruiz', 'T√©cnico', '4', '38', '‚≠ê‚≠ê‚≠ê‚≠ê'],
            ['Ana Mart√≠nez', 'Coordinadora', '2', '35', '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê'],
            ['Luis Garc√≠a', 'T√©cnico Junior', '3', '40', '‚≠ê‚≠ê‚≠ê‚≠ê']
          ]
        }
      };

      return templates[type] || templates.performance;
    }

    function generateSummary(type, data) {
      const summaries = {
        performance: [
          '‚úÖ Todas las m√©tricas clave superan los objetivos establecidos',
          'üìà Incremento del 20% en proyectos completados vs. mes anterior',
          '‚≠ê Satisfacci√≥n del cliente en nivel excelente (4.8/5)',
          'üéØ Reducci√≥n significativa en tiempos de entrega y retrabajo'
        ],
        projects: [
          `üìä Total de proyectos en el sistema: ${data.rows.length}`,
          '‚úÖ 20% de proyectos completados exitosamente',
          '‚è±Ô∏è 60% de proyectos en progreso seg√∫n cronograma',
          'üìÖ 20% en fase de planeaci√≥n para inicio pr√≥ximo'
        ],
        revenue: [
          'üí∞ Crecimiento sostenido mes a mes (+18.4%)',
          'üéØ Margen de utilidad: 40% sobre costos operativos',
          'üìà Proyecci√≥n anual: $5.4M basado en tendencia actual',
          '‚úÖ Diversificaci√≥n exitosa de fuentes de ingreso'
        ],
        team: [
          `üë• Equipo de ${data.rows.length} profesionales activos`,
          '‚≠ê Rendimiento promedio del equipo: 4.6/5',
          '‚è∞ Utilizaci√≥n √≥ptima de recursos (39hrs/sem promedio)',
          'üéØ Balance adecuado de carga de trabajo entre miembros'
        ]
      };

      return summaries[type] || summaries.performance;
    }

    function scheduleReport() {
      const reportType = document.getElementById('report-type').value;
      const format = document.getElementById('report-format').value;
      
      const scheduleOptions = `
        <div style="padding: 20px;">
          <h3 style="margin-bottom: 15px;">Programar Reporte Autom√°tico</h3>
          <p style="margin-bottom: 15px;">Tipo: ${reportType.toUpperCase()} | Formato: ${format.toUpperCase()}</p>
          
          <label style="display: block; margin-bottom: 10px;">
            <strong>Frecuencia:</strong><br>
            <select style="width: 100%; padding: 8px; margin-top: 5px;">
              <option>Diario</option>
              <option>Semanal</option>
              <option selected>Mensual</option>
              <option>Trimestral</option>
            </select>
          </label>
          
          <label style="display: block; margin-bottom: 10px;">
            <strong>Enviar a:</strong><br>
            <input type="email" placeholder="correo@ejemplo.com" style="width: 100%; padding: 8px; margin-top: 5px;">
          </label>
          
          <button onclick="confirmSchedule()" style="background: #02735E; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; margin-top: 10px;">
            Confirmar Programaci√≥n
          </button>
        </div>
      `;
      
      showNotification('üìÖ Programar Reporte', scheduleOptions, 'info');
    }

    function confirmSchedule() {
      showNotification('‚úÖ Reporte Programado', 'El reporte se generar√° y enviar√° autom√°ticamente seg√∫n la frecuencia seleccionada.', 'success');
    }

    function showNotification(title, message, type = 'info') {
      if (window.NotifyManager) {
        NotifyManager.create({
          title: title,
          message: message,
          type: type,
          duration: 5000
        });
      } else {
        alert(`${title}\n\n${message}`);
      }
    }

    // ====== INITIALIZE ALL FEATURES ======
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        initProjectsTrendChart();
        initTopProjects();
        initHeatmap();
        initActivityFeed();
        initTodayAppointments();
        updateTodayDate();
        
        // Conectar selector de per√≠odo del chart
        const chartPeriodSelect = document.getElementById('chart-period');
        if (chartPeriodSelect) {
          chartPeriodSelect.addEventListener('change', function() {
            const days = parseInt(this.value);
            console.log(`üìä Cambiando per√≠odo a ${days} d√≠as`);
            initProjectsTrendChart(days);
          });
        }
        
        console.log('‚ú® Analytics page initialized');
        console.log('‚úÖ Todos los botones est√°n conectados y funcionando');
      }, 300);
    });
  </script>
  </section>
  </main>
  </div>
  </div>
</body>
</html>

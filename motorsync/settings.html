<!DOCTYPE html>
<html lang="es" data-theme="light" style="--primary-color: #02735E;">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Configuración - Settings | Opsis Suite</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;500;600;700;900&display=swap">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
  <script src="js/modules.js"></script>
  <script src="notifications-manager.js"></script>
  <script>
    (function () {
      try {
        var settings = JSON.parse(localStorage.getItem('opsis_settings') || '{}');
        var theme = settings.theme || 'light';
        document.documentElement.dataset.theme = theme;
        if (settings.accent) {
          document.documentElement.style.setProperty('--primary-color', settings.accent);
        }
      } catch (err) {
        document.documentElement.dataset.theme = 'light';
      }
    })();
  </script>
  
</head>
<body>
  <div class="app-shell" data-theme="light" data-accent="#02735E">
    <header style="background: linear-gradient(135deg, #02735E 0%, #035951 50%, #034040 100%); background-size: 200% 200%; animation: aire 8s ease infinite; padding: 0; display: flex; align-items: flex-end;">
      <div class="logo" aria-label="Opsis Suite" style="padding: 18px 32px;">
        <div class="logo-text">
          <div class="logo-title">Opsis Suite</div>
          <div id="company-name-header" style="font-size: 12px; font-weight: 500; color: rgba(255,255,255,0.85); margin-top: 2px;">CVE San Diego</div>
        </div>
      </div>
      
      <!-- Module Tabs -->
      <div class="module-tabs" id="module-tabs-container" style="display: flex; gap: 0;">
        <a href="motorsync.html" class="module-tab">MotorSync</a>
        <a href="../timesync/timesync.html" class="module-tab">TimeSync</a>
      </div>
    </header>
    
    <div class="app-content">
      <aside id="sidebar">
        <a href="motorsync.html" class="sidebar-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="9"></rect>
            <rect x="14" y="3" width="7" height="5"></rect>
            <rect x="14" y="12" width="7" height="9"></rect>
            <rect x="3" y="16" width="7" height="5"></rect>
          </svg>
          <span>Dashboard</span>
        </a>
        
        <a href="plansync.html" class="sidebar-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
          </svg>
          <span>PlanSync</span>
        </a>
        
        <a href="projectsync.html" class="sidebar-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="9" y1="3" x2="9" y2="21"></line>
          </svg>
          <span>ProjectSync</span>
        </a>

        <a href="threadsync-list.html" class="sidebar-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          <span>ThreadSync</span>
        </a>

        <a href="howsync.html" class="sidebar-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="2"></circle>
            <path d="M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"></path>
          </svg>
          <span>HowSync</span>
        </a>

        <a href="analytics.html" class="sidebar-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="20" x2="12" y2="10"></line>
            <line x1="18" y1="20" x2="18" y2="4"></line>
            <line x1="6" y1="20" x2="6" y2="16"></line>
          </svg>
          <span>Analytics</span>
        </a>

        <a href="clientsync.html" class="sidebar-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M22 21v-2a4 4 0 0 0-3-3.87m-3-12.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          <span>ClientSync</span>
        </a>

        <a href="management.html" class="sidebar-item">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="1" x2="12" y2="23"></line>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
          <span>Management</span>
        </a>

        <a href="settings.html" class="sidebar-item active">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="3"></circle>
            <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3m15.4-6.4l-4.2 4.2m-7.1 0L2.6 5.6m18.8 12.8l-4.2-4.2m-7.1 0l-4.5 4.5"></path>
          </svg>
          <span>Configuración</span>
        </a>
      </aside>

      <main id="main">
        <section class="page">
          <div class="page-header">
            <h2 class="page-title" id="settings-title" data-i18n="settings">Configuración</h2>
          </div>

          <!-- KPIs Summary -->
          <div class="grid grid-3 kpi-grid" id="settings-kpis">
            <div class="stat-card">
              <div class="stat-label" data-i18n="settingsKpiCompany">Compañía</div>
              <div class="stat-value" id="settings-kpi-company">CVE San Diego</div>
              <div class="stat-change" id="settings-kpi-company-hint">Nombre mostrado en Opsis</div>
            </div>
            <div class="stat-card">
              <div class="stat-label" data-i18n="settingsKpiTheme">Modo</div>
              <div class="stat-value" id="settings-kpi-theme">Claro</div>
              <div class="stat-change" id="settings-kpi-theme-hint">Modo actual</div>
            </div>
            <div class="stat-card">
              <div class="stat-label" data-i18n="settingsKpiLanguage">Idioma</div>
              <div class="stat-value" id="settings-kpi-language">Español</div>
              <div class="stat-change" id="settings-kpi-language-hint">UI predeterminado</div>
            </div>
          </div>

          <!-- Company Identity -->
          <div class="card">
            <div class="card-header">
              <div>
                <h3 class="card-title" data-i18n="settingsCompanyCard">Identidad y contacto</h3>
                <p class="settings-note" data-i18n="settingsCompanySubtitle">Nombre visible en app y datos básicos de contacto.</p>
              </div>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label data-i18n="companyName">Nombre de la empresa</label>
                <input type="text" id="settings-company" value="CVE San Diego">
              </div>
              <div class="form-group">
                <label data-i18n="phone">Teléfono</label>
                <input type="tel" id="settings-phone" value="+1 (619) 555-0100">
              </div>
              <div class="form-group">
                <label data-i18n="email">Email</label>
                <input type="email" id="settings-email" value="contacto@cvesandiego.com">
              </div>
            </div>
            <div class="settings-actions">
              <button class="btn btn-primary" id="btn-settings-save" data-i18n="settingsSaveButton">Guardar cambios</button>
            </div>
          </div>

          <!-- Premium Modules -->
          <div class="card">
            <div class="card-header">
              <div>
                <h3 class="card-title">Módulos Premium Activos</h3>
                <p class="settings-note">Módulos habilitados por tu plan. Contacta soporte para activar más.</p>
              </div>
            </div>
            <div class="grid grid-2" style="gap: 16px; margin-top: 16px;">
              <div class="module-card active">
                <div class="module-icon" style="background: #02735E;">MS</div>
                <div class="module-info">
                  <h4>MotorSync Base</h4>
                  <p>Sistema operacional completo</p>
                  <span class="module-status active">✓ Activo</span>
                </div>
              </div>
              <div class="module-card active">
                <div class="module-icon" style="background: #035951;">TS</div>
                <div class="module-info">
                  <h4>TimeSync</h4>
                  <p>Gestión de tiempo y asistencias</p>
                  <span class="module-status active">✓ Activo</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Branding -->
          <div class="card">
            <div class="card-header">
              <div>
                <h3 class="card-title" data-i18n="settingsBrandingCard">Branding y apariencia</h3>
                <p class="settings-note" data-i18n="settingsBrandingSubtitle">Define tu logo, color corporativo y preferencias visuales.</p>
              </div>
            </div>
            <div class="form-grid">
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Logo de tu empresa</label>
                <div style="display: flex; align-items: center; gap: 16px; margin-top: 8px;">
                  <div id="logo-preview" style="width: 120px; height: 120px; border: 2px dashed rgba(2, 115, 94, 0.3); border-radius: 12px; display: flex; align-items: center; justify-content: center; background: rgba(2, 115, 94, 0.05); color: #02735E; font-size: 14px; font-weight: 600;">
                    Sin logo
                  </div>
                  <div style="flex: 1;">
                    <input type="file" id="logo-upload" accept="image/*" style="display: none;">
                    <button type="button" class="btn btn-secondary" onclick="document.getElementById('logo-upload').click();">Subir logo</button>
                    <p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">Recomendado: PNG o SVG, máximo 2MB</p>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label data-i18n="accentColor">Color de acento corporativo</label>
                <div style="display: flex; gap: 12px; align-items: center;">
                  <input type="color" id="accent-picker" value="#02735E" style="width: 60px; height: 40px; border-radius: 8px; border: 1px solid var(--border-color); cursor: pointer;">
                  <input type="text" id="accent-hex" value="#02735E" readonly style="flex: 1; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 8px; background: var(--bg-card); font-family: monospace;">
                </div>
                <p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">Se aplicará sobre la base VERDI</p>
              </div>
              <div class="form-group">
                <label data-i18n="uiTheme">Modo de interfaz</label>
                <select id="theme-select">
                  <option value="light" data-i18n="settingsThemeLight">Claro</option>
                  <option value="dark" data-i18n="settingsThemeDark">Oscuro</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Localization -->
          <div class="card">
            <div class="card-header">
              <div>
                <h3 class="card-title" data-i18n="settingsLocalizationCard">Localización y datos</h3>
                <p class="settings-note" data-i18n="settingsLocalizationSubtitle">Controla el idioma y reinicia la data demo.</p>
              </div>
            </div>
            <div class="form-grid">
              <div class="form-group">
                <label data-i18n="uiLanguage">Idioma del sistema</label>
                <select id="language-select">
                  <option value="es">Español</option>
                  <option value="en">English</option>
                </select>
              </div>
            </div>
            <div class="settings-divider"></div>
            <div>
              <label data-i18n="resetDemoTitle">Datos de demostración</label>
              <p class="settings-note" data-i18n="resetDemoHint">Borra y vuelve a cargar la información de ejemplo.</p>
              <button type="button" class="btn btn-secondary" id="btn-reset-demo" data-i18n="resetDemoButton" style="margin-top: 12px;">Reiniciar</button>
            </div>
          </div>

          <!-- Notification Preferences -->
          <div class="card">
            <div class="card-header">
              <div>
                <h3 class="card-title" data-i18n="settingsNotificationsCard">Preferencias de notificaciones</h3>
                <p class="settings-note" data-i18n="settingsNotificationsSubtitle">Activa los canales (Email, SMS, In-App) para cada perfil del sistema.</p>
              </div>
              <button class="btn btn-secondary" id="btn-save-notifications" data-i18n="settingsNotificationsSave">Guardar preferencias</button>
            </div>
            <div class="table-wrapper">
              <table class="notification-preferences">
                <thead>
                  <tr>
                    <th data-i18n="settingsNotificationsColumnRole">Perfil</th>
                    <th data-i18n="settingsNotificationsColumnEmail">Email</th>
                    <th data-i18n="settingsNotificationsColumnSms">SMS</th>
                    <th data-i18n="settingsNotificationsColumnInApp">In-App</th>
                  </tr>
                </thead>
                <tbody id="notification-settings-table">
                  <tr>
                    <td><strong>Owner</strong></td>
                    <td><input type="checkbox" checked></td>
                    <td><input type="checkbox" checked></td>
                    <td><input type="checkbox" checked></td>
                  </tr>
                  <tr>
                    <td><strong>Admin</strong></td>
                    <td><input type="checkbox" checked></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox" checked></td>
                  </tr>
                  <tr>
                    <td><strong>Técnico</strong></td>
                    <td><input type="checkbox"></td>
                    <td><input type="checkbox" checked></td>
                    <td><input type="checkbox" checked></td>
                  </tr>
                  <tr>
                    <td><strong>Cliente</strong></td>
                    <td><input type="checkbox" checked></td>
                    <td><input type="checkbox" checked></td>
                    <td><input type="checkbox"></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 12px;" data-i18n="settingsNotificationsFooter">
              Los cambios aplican para alertas operativas (MotorSync), asignaciones (TimeSync), logística (ToolSync) y facturación (FinanSync).
            </p>
          </div>

          <!-- Role Access -->
          <div class="card">
            <div class="card-header">
              <div>
                <h3 class="card-title" data-i18n="settingsRoleAccessCard">Accesos por rol</h3>
                <p class="settings-note" data-i18n="settingsRoleAccessSubtitle">Consulta qué áreas puede ver cada rol y quién puede enviar invitaciones.</p>
              </div>
            </div>
            <div class="table-wrapper">
              <table class="role-access-table">
                <thead>
                  <tr>
                    <th data-i18n="settingsRoleAccessColumnRole">Rol</th>
                    <th data-i18n="settingsRoleAccessColumnPages">Áreas disponibles</th>
                    <th data-i18n="settingsRoleAccessColumnInvites">Puede invitar</th>
                  </tr>
                </thead>
                <tbody id="role-access-table">
                  <tr>
                    <td><strong>Owner</strong></td>
                    <td>Todas las áreas</td>
                    <td><span class="badge">✓ Sí</span></td>
                  </tr>
                  <tr>
                    <td><strong>Admin</strong></td>
                    <td>Dashboard, Analytics, ClientSync, Management</td>
                    <td><span class="badge">✓ Sí</span></td>
                  </tr>
                  <tr>
                    <td><strong>Técnico</strong></td>
                    <td>Dashboard, PlanSync, ProjectSync</td>
                    <td><span style="color: var(--text-secondary);">No</span></td>
                  </tr>
                  <tr>
                    <td><strong>Cliente</strong></td>
                    <td>Portal de cliente</td>
                    <td><span style="color: var(--text-secondary);">No</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 12px;" data-i18n="settingsRoleAccessInviteHint">
              Owner y Admin pueden invitar técnicos, labor, clientes y contratistas para operar MotorSync.
            </p>
          </div>
        </section>
      </main>
    </div>
  </div>

  <script>
    // Settings functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Load settings from localStorage
      const settings = JSON.parse(localStorage.getItem('opsis_settings') || '{}');
      
      // Populate company info
      if (settings.company) {
        document.getElementById('settings-company').value = settings.company;
        document.getElementById('settings-kpi-company').textContent = settings.company;
      }
      
      if (settings.phone) {
        document.getElementById('settings-phone').value = settings.phone;
      }
      
      if (settings.email) {
        document.getElementById('settings-email').value = settings.email;
      }
      
      // Theme
      const theme = settings.theme || 'light';
      document.getElementById('theme-select').value = theme;
      document.getElementById('settings-kpi-theme').textContent = theme === 'light' ? 'Claro' : 'Oscuro';
      
      // Language
      const lang = settings.language || 'es';
      document.getElementById('language-select').value = lang;
      document.getElementById('settings-kpi-language').textContent = lang === 'es' ? 'Español' : 'English';
      
      // Accent color
      const accent = settings.accent || '#02735E';
      document.getElementById('accent-picker').value = accent;
      document.getElementById('accent-hex').value = accent;
      
      // Save settings
      document.getElementById('btn-settings-save').addEventListener('click', function() {
        const newSettings = {
          company: document.getElementById('settings-company').value,
          phone: document.getElementById('settings-phone').value,
          email: document.getElementById('settings-email').value,
          theme: document.getElementById('theme-select').value,
          language: document.getElementById('language-select').value,
          accent: document.getElementById('accent-picker').value
        };
        
        localStorage.setItem('opsis_settings', JSON.stringify(newSettings));
        
        // Update KPIs
        document.getElementById('settings-kpi-company').textContent = newSettings.company;
        document.getElementById('settings-kpi-theme').textContent = newSettings.theme === 'light' ? 'Claro' : 'Oscuro';
        document.getElementById('settings-kpi-language').textContent = newSettings.language === 'es' ? 'Español' : 'English';
        
        // Apply theme
        document.documentElement.dataset.theme = newSettings.theme;
        
        // Apply accent
        document.documentElement.style.setProperty('--primary-color', newSettings.accent);
        
        alert('Configuración guardada exitosamente');
      });
      
      // Accent color picker sync
      document.getElementById('accent-picker').addEventListener('input', function(e) {
        document.getElementById('accent-hex').value = e.target.value;
      });
      
      // Theme change
      document.getElementById('theme-select').addEventListener('change', function(e) {
        document.documentElement.dataset.theme = e.target.value;
      });
      
      // Reset demo data
      document.getElementById('btn-reset-demo').addEventListener('click', function() {
        if (confirm('¿Estás seguro de que quieres reiniciar los datos de demostración? Esta acción no se puede deshacer.')) {
          // Clear all demo data from localStorage
          const keysToKeep = ['opsis_settings'];
          const allKeys = Object.keys(localStorage);
          allKeys.forEach(key => {
            if (!keysToKeep.includes(key)) {
              localStorage.removeItem(key);
            }
          });
          alert('Datos de demostración reiniciados. Recarga la página para ver los cambios.');
          location.reload();
        }
      });
      
      // Save notification preferences
      document.getElementById('btn-save-notifications').addEventListener('click', function() {
        alert('Preferencias de notificaciones guardadas');
      });
    });
  </script>
</body>
</html>

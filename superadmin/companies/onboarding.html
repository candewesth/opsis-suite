<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nueva Compa√±√≠a - SuperAdmin | Opsis Suite</title>
    <link rel="stylesheet" href="../css/superadmin.css">
    <style>
        .onboarding-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
        }
        
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: var(--border-color);
            z-index: 0;
        }
        
        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--hover-bg);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 0.5rem;
            transition: all 0.3s;
        }
        
        .step.active .step-number {
            background: var(--primary-green);
            border-color: var(--primary-green);
            color: white;
        }
        
        .step.completed .step-number {
            background: var(--primary-green);
            border-color: var(--primary-green);
            color: white;
        }
        
        .step-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .step.active .step-label {
            color: var(--primary-green);
            font-weight: 500;
        }
        
        .onboarding-step {
            display: none;
        }
        
        .onboarding-step.active {
            display: block;
        }
        
        .industry-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .industry-card {
            padding: 1.5rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .industry-card:hover {
            border-color: var(--primary-green);
            background: rgba(34, 197, 94, 0.05);
        }
        
        .industry-card.selected {
            border-color: var(--primary-green);
            background: rgba(34, 197, 94, 0.1);
        }
        
        .industry-card .icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .product-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .product-card {
            padding: 1.5rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .product-card:hover {
            border-color: var(--primary-green);
        }
        
        .product-card.selected {
            border-color: var(--primary-green);
            background: rgba(34, 197, 94, 0.1);
        }
        
        .product-card .icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }
        
        .product-card .name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .product-card .price {
            color: var(--primary-green);
            font-weight: 600;
        }
        
        .plan-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }
        
        .plan-card {
            padding: 2rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-lg);
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .plan-card:hover {
            border-color: var(--primary-green);
        }
        
        .plan-card.selected {
            border-color: var(--primary-green);
            background: rgba(34, 197, 94, 0.1);
        }
        
        .plan-card.recommended {
            position: relative;
        }
        
        .plan-card.recommended::before {
            content: '‚≠ê Recomendado';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--primary-green);
            color: white;
            padding: 0.25rem 1rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .step-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }
    </style>
</head>
<body>
    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar"></aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="onboarding-container">
                <!-- Page Header -->
                <div class="page-header">
                    <div>
                        <h1 class="page-title">üöÄ Nueva Compa√±√≠a</h1>
                        <p class="page-subtitle">Registra una nueva compa√±√≠a cliente en Opsis Suite</p>
                    </div>
                    <button class="btn btn-secondary" onclick="location.href='list.html'">
                        ‚Üê Cancelar
                    </button>
                </div>

                <!-- Step Indicator -->
                <div class="card">
                    <div class="step-indicator">
                        <div class="step active" data-step="1">
                            <div class="step-number">1</div>
                            <div class="step-label">Industria</div>
                        </div>
                        <div class="step" data-step="2">
                            <div class="step-number">2</div>
                            <div class="step-label">Productos</div>
                        </div>
                        <div class="step" data-step="3">
                            <div class="step-number">3</div>
                            <div class="step-label">Informaci√≥n</div>
                        </div>
                        <div class="step" data-step="4">
                            <div class="step-number">4</div>
                            <div class="step-label">Plan</div>
                        </div>
                        <div class="step" data-step="5">
                            <div class="step-number">5</div>
                            <div class="step-label">Resumen</div>
                        </div>
                    </div>

                    <!-- Step 1: Industry -->
                    <div class="onboarding-step active" id="step-1">
                        <h3 style="margin-bottom: 0.5rem;">Selecciona la Industria</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">¬øA qu√© sector pertenece la compa√±√≠a?</p>
                        
                        <div class="industry-grid" id="industryGrid">
                            <!-- Populated by JS -->
                        </div>
                    </div>

                    <!-- Step 2: Products -->
                    <div class="onboarding-step" id="step-2">
                        <h3 style="margin-bottom: 0.5rem;">Selecciona los Productos</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">¬øQu√© m√≥dulos necesita la compa√±√≠a? Puedes seleccionar varios.</p>
                        
                        <div class="product-grid" id="productGrid">
                            <!-- Populated by JS -->
                        </div>
                        
                        <div style="margin-top: 1.5rem; padding: 1rem; background: var(--hover-bg); border-radius: var(--border-radius); text-align: center;">
                            <p style="color: var(--text-secondary);">Total estimado:</p>
                            <p style="font-size: 1.5rem; font-weight: 700; color: var(--primary-green);" id="totalPrice">$0/mes</p>
                        </div>
                    </div>

                    <!-- Step 3: Company Info -->
                    <div class="onboarding-step" id="step-3">
                        <h3 style="margin-bottom: 0.5rem;">Informaci√≥n de la Compa√±√≠a</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Datos b√°sicos de la organizaci√≥n</p>
                        
                        <div class="grid-2">
                            <div class="form-group">
                                <label class="form-label">Nombre de la Compa√±√≠a *</label>
                                <input type="text" class="form-input" id="companyName" placeholder="Ej: Constructora ABC S.A.">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Subdominio *</label>
                                <div style="display: flex; align-items: center;">
                                    <input type="text" class="form-input" id="companyDomain" placeholder="mi-empresa" style="border-radius: var(--border-radius) 0 0 var(--border-radius);">
                                    <span style="padding: 0.75rem 1rem; background: var(--hover-bg); border: 1px solid var(--border-color); border-left: none; border-radius: 0 var(--border-radius) var(--border-radius) 0; color: var(--text-secondary); white-space: nowrap;">.opsis-suite.com</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid-2">
                            <div class="form-group">
                                <label class="form-label">Email del Administrador *</label>
                                <input type="email" class="form-input" id="companyEmail" placeholder="admin@empresa.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tel√©fono</label>
                                <input type="tel" class="form-input" id="companyPhone" placeholder="+1 555-0100">
                            </div>
                        </div>
                    </div>

                    <!-- Step 4: Plan -->
                    <div class="onboarding-step" id="step-4">
                        <h3 style="margin-bottom: 0.5rem;">Selecciona el Plan</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Elige el plan que mejor se adapte a la compa√±√≠a</p>
                        
                        <div class="plan-grid">
                            <div class="plan-card" data-plan="starter" onclick="selectPlan('starter')">
                                <div style="font-size: 2rem; margin-bottom: 1rem;">üå±</div>
                                <h4>Starter</h4>
                                <p style="font-size: 2rem; font-weight: 700; margin: 1rem 0;">$49<span style="font-size: 1rem; font-weight: 400;">/mes</span></p>
                                <ul style="text-align: left; font-size: 0.875rem; color: var(--text-secondary);">
                                    <li>1 producto incluido</li>
                                    <li>Hasta 5 usuarios</li>
                                    <li>10GB almacenamiento</li>
                                    <li>Soporte por email</li>
                                </ul>
                            </div>
                            <div class="plan-card recommended" data-plan="professional" onclick="selectPlan('professional')">
                                <div style="font-size: 2rem; margin-bottom: 1rem;">‚ö°</div>
                                <h4>Professional</h4>
                                <p style="font-size: 2rem; font-weight: 700; margin: 1rem 0;">$99<span style="font-size: 1rem; font-weight: 400;">/mes</span></p>
                                <ul style="text-align: left; font-size: 0.875rem; color: var(--text-secondary);">
                                    <li>Hasta 3 productos</li>
                                    <li>Hasta 25 usuarios</li>
                                    <li>50GB almacenamiento</li>
                                    <li>Soporte prioritario</li>
                                </ul>
                            </div>
                            <div class="plan-card" data-plan="enterprise" onclick="selectPlan('enterprise')">
                                <div style="font-size: 2rem; margin-bottom: 1rem;">üè¢</div>
                                <h4>Enterprise</h4>
                                <p style="font-size: 2rem; font-weight: 700; margin: 1rem 0;">$249<span style="font-size: 1rem; font-weight: 400;">/mes</span></p>
                                <ul style="text-align: left; font-size: 0.875rem; color: var(--text-secondary);">
                                    <li>Productos ilimitados</li>
                                    <li>Usuarios ilimitados</li>
                                    <li>500GB almacenamiento</li>
                                    <li>Soporte 24/7 dedicado</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <button class="btn btn-secondary" onclick="selectPlan('trial')">
                                üß™ Iniciar con Trial Gratuito (14 d√≠as)
                            </button>
                        </div>
                    </div>

                    <!-- Step 5: Summary -->
                    <div class="onboarding-step" id="step-5">
                        <h3 style="margin-bottom: 0.5rem;">Resumen de Configuraci√≥n</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">Revisa los detalles antes de crear la compa√±√≠a</p>
                        
                        <div class="grid-2" style="gap: 2rem; background: var(--hover-bg); padding: 2rem; border-radius: var(--border-radius-lg);">
                            <div>
                                <h4 style="margin-bottom: 1rem;">üìã Informaci√≥n</h4>
                                <div id="summaryInfo"><!-- Populated by JS --></div>
                            </div>
                            <div>
                                <h4 style="margin-bottom: 1rem;">üí∞ Facturaci√≥n</h4>
                                <div id="summaryBilling"><!-- Populated by JS --></div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 1.5rem;">
                            <h4 style="margin-bottom: 1rem;">üì¶ Productos Seleccionados</h4>
                            <div id="summaryProducts" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                <!-- Populated by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Navigation -->
                    <div class="step-navigation">
                        <button class="btn btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">
                            ‚Üê Anterior
                        </button>
                        <div style="flex: 1;"></div>
                        <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">
                            Siguiente ‚Üí
                        </button>
                        <button class="btn btn-primary" id="createBtn" onclick="createCompany()" style="display: none;">
                            üöÄ Crear Compa√±√≠a
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="../js/sidebar.js"></script>
    <script src="../js/data.js"></script>
    <script>
        let currentStep = 1;
        const totalSteps = 5;
        
        const formData = {
            industry: null,
            products: [],
            companyName: '',
            companyDomain: '',
            companyEmail: '',
            companyPhone: '',
            plan: null,
            totalPrice: 0
        };

        document.addEventListener('DOMContentLoaded', () => {
            loadIndustryGrid();
            loadProductGrid();
        });

        function loadIndustryGrid() {
            const grid = document.getElementById('industryGrid');
            grid.innerHTML = Object.entries(SuperAdminData.industries).map(([key, industry]) => `
                <div class="industry-card" data-industry="${key}" onclick="selectIndustry('${key}')">
                    <div class="icon">${industry.icon}</div>
                    <div class="name">${industry.name}</div>
                </div>
            `).join('');
        }

        function loadProductGrid() {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = Object.entries(SuperAdminData.products).map(([key, product]) => `
                <div class="product-card" data-product="${key}" onclick="toggleProduct('${key}')">
                    <div class="icon">${product.icon}</div>
                    <div class="name">${product.name}</div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary); margin: 0.5rem 0;">${product.description}</div>
                    <div class="price">$${product.basePrice}/mes</div>
                    ${product.status === 'coming-soon' ? '<span style="font-size: 0.7rem; color: var(--warning-orange);">Pr√≥ximamente</span>' : ''}
                </div>
            `).join('');
        }

        function selectIndustry(key) {
            formData.industry = key;
            document.querySelectorAll('.industry-card').forEach(card => card.classList.remove('selected'));
            document.querySelector(`[data-industry="${key}"]`).classList.add('selected');
        }

        function toggleProduct(key) {
            const index = formData.products.indexOf(key);
            const card = document.querySelector(`[data-product="${key}"]`);
            
            if (index > -1) {
                formData.products.splice(index, 1);
                card.classList.remove('selected');
            } else {
                formData.products.push(key);
                card.classList.add('selected');
            }
            
            updateTotalPrice();
        }

        function updateTotalPrice() {
            let total = 0;
            formData.products.forEach(key => {
                total += SuperAdminData.products[key].basePrice;
            });
            formData.totalPrice = total;
            document.getElementById('totalPrice').textContent = `$${total}/mes`;
        }

        function selectPlan(plan) {
            formData.plan = plan;
            document.querySelectorAll('.plan-card').forEach(card => card.classList.remove('selected'));
            const selected = document.querySelector(`[data-plan="${plan}"]`);
            if (selected) selected.classList.add('selected');
        }

        function nextStep() {
            // Validate current step
            if (!validateStep(currentStep)) return;
            
            if (currentStep < totalSteps) {
                document.querySelector(`#step-${currentStep}`).classList.remove('active');
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('completed');
                
                currentStep++;
                
                document.querySelector(`#step-${currentStep}`).classList.add('active');
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
                
                updateNavigation();
                
                if (currentStep === 5) {
                    loadSummary();
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                document.querySelector(`#step-${currentStep}`).classList.remove('active');
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
                
                currentStep--;
                
                document.querySelector(`#step-${currentStep}`).classList.add('active');
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
                document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('completed');
                
                updateNavigation();
            }
        }

        function validateStep(step) {
            switch(step) {
                case 1:
                    if (!formData.industry) {
                        showToast('Por favor selecciona una industria', 'error');
                        return false;
                    }
                    break;
                case 2:
                    if (formData.products.length === 0) {
                        showToast('Por favor selecciona al menos un producto', 'error');
                        return false;
                    }
                    break;
                case 3:
                    formData.companyName = document.getElementById('companyName').value;
                    formData.companyDomain = document.getElementById('companyDomain').value;
                    formData.companyEmail = document.getElementById('companyEmail').value;
                    formData.companyPhone = document.getElementById('companyPhone').value;
                    
                    if (!formData.companyName || !formData.companyDomain || !formData.companyEmail) {
                        showToast('Por favor completa los campos requeridos', 'error');
                        return false;
                    }
                    break;
                case 4:
                    if (!formData.plan) {
                        showToast('Por favor selecciona un plan', 'error');
                        return false;
                    }
                    break;
            }
            return true;
        }

        function updateNavigation() {
            document.getElementById('prevBtn').style.display = currentStep > 1 ? 'block' : 'none';
            document.getElementById('nextBtn').style.display = currentStep < totalSteps ? 'block' : 'none';
            document.getElementById('createBtn').style.display = currentStep === totalSteps ? 'block' : 'none';
        }

        function loadSummary() {
            const industry = SuperAdminData.getIndustry(formData.industry);
            const plan = SuperAdminData.plans[formData.plan];
            
            document.getElementById('summaryInfo').innerHTML = `
                <p><strong>Nombre:</strong> ${formData.companyName}</p>
                <p><strong>Dominio:</strong> ${formData.companyDomain}.opsis-suite.com</p>
                <p><strong>Email:</strong> ${formData.companyEmail}</p>
                <p><strong>Tel√©fono:</strong> ${formData.companyPhone || 'No especificado'}</p>
                <p><strong>Industria:</strong> ${industry.icon} ${industry.name}</p>
            `;
            
            document.getElementById('summaryBilling').innerHTML = `
                <p><strong>Plan:</strong> ${plan.name}</p>
                <p><strong>Precio base:</strong> $${plan.price}/mes</p>
                <p><strong>Productos:</strong> $${formData.totalPrice}/mes</p>
                <p style="font-size: 1.25rem; font-weight: 700; color: var(--primary-green); margin-top: 1rem;">
                    Total: $${plan.price + formData.totalPrice}/mes
                </p>
            `;
            
            document.getElementById('summaryProducts').innerHTML = formData.products.map(key => {
                const product = SuperAdminData.products[key];
                return `<span style="padding: 0.5rem 1rem; background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(78, 205, 196, 0.1)); border-radius: 20px;">${product.icon} ${product.name}</span>`;
            }).join('');
        }

        function createCompany() {
            const newCompany = {
                id: Date.now(),
                name: formData.companyName,
                industry: formData.industry,
                plan: SuperAdminData.plans[formData.plan].name,
                products: formData.products.map(key => SuperAdminData.products[key].name),
                status: formData.plan === 'trial' ? 'trial' : 'active',
                users: 1,
                mrr: formData.plan === 'trial' ? 0 : SuperAdminData.plans[formData.plan].price + formData.totalPrice,
                domain: formData.companyDomain,
                email: formData.companyEmail,
                phone: formData.companyPhone,
                createdAt: new Date().toISOString().split('T')[0],
                lastActive: new Date().toISOString().split('T')[0]
            };
            
            SuperAdminData.companies.push(newCompany);
            
            showToast(`Compa√±√≠a "${newCompany.name}" creada exitosamente`, 'success');
            
            setTimeout(() => {
                location.href = 'list.html';
            }, 1500);
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span> ${message}`;
            
            let container = document.querySelector('.toast-container');
            if (!container) {
                container = document.createElement('div');
                container.className = 'toast-container';
                document.body.appendChild(container);
            }
            container.appendChild(toast);
            
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Opsis Suite</title>
    
    <!-- Supabase JavaScript SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Apple 96 Design System Variables - Copiado exacto del superadmin */
        :root {
            --bg-color: #f8fafc;
            --card-bg: white;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-tertiary: #94a3b8;
            --border-color: #e2e8f0;
            --hover-bg: #f1f5f9;
            --primary-green: #22c55e;
            --primary-green-hover: #16a34a;
            --danger-red: #ef4444;
            --danger-red-hover: #dc2626;
            --warning-orange: #f59e0b;
            --info-blue: #3b82f6;
            --purple: #8b5cf6;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.1);
            --border-radius: 12px;
            --border-radius-lg: 16px;
            --border-radius-xl: 20px;
        }

        [data-theme="dark"] {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border-color: #334155;
            --hover-bg: #334155;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Header Premium Apple Style - Copiado exacto */
        .header {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Logo exacto del superadmin */
        .logo-container {
            position: relative;
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius);
            padding: 2px;
            background: linear-gradient(45deg, var(--primary-green), #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3, #54a0ff, #5f27cd, #00d2d3, #ff9f43, #10ac84, #ee5a6f, var(--primary-green));
            background-size: 400% 400%;
            animation: gradientShift 4s ease-in-out infinite;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.2);
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, #495057, #6c757d);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: white;
            position: relative;
        }

        .logo-icon.has-image {
            background: white;
            overflow: hidden;
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }

        .logo-icon::after {
            content: '‚óâ';
            animation: winkEye 4s ease-in-out infinite;
        }

        .logo-icon.has-image::after {
            display: none;
        }

        @keyframes winkEye {
            0%, 90%, 100% { content: '‚óâ'; }
            95% { content: '‚óâ'; }
        }

        .header-info h1 {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .header-info p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .profile-info {
            text-align: right;
            margin-right: 1rem;
        }

        .profile-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .profile-role {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .logout-btn {
            padding: 0.5rem 1rem;
            background: var(--danger-red);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: var(--danger-red-hover);
            transform: translateY(-1px);
        }

        /* Stats Grid exacto del superadmin */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary-green);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
        }

        .stat-icon.companies { background: linear-gradient(135deg, var(--primary-green), var(--primary-green-hover)); }
        .stat-icon.users { background: linear-gradient(135deg, var(--info-blue), #1d4ed8); }
        .stat-icon.revenue { background: linear-gradient(135deg, var(--warning-orange), #d97706); }
        .stat-icon.activity { background: linear-gradient(135deg, var(--purple), #7c3aed); }

        .stat-trend {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-weight: 500;
        }

        .stat-trend.up {
            background: #dcfce7;
            color: #166534;
        }

        .stat-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .stat-description {
            font-size: 0.75rem;
            color: var(--text-tertiary);
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-green), #4ecdc4);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            color: white;
            transition: all 0.8s ease;
        }

        .loading-screen.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-logo {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            background: rgba(255,255,255,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 1.5rem;
            animation: pulse 2s ease-in-out infinite;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .loading-logo.has-image {
            background: white;
            overflow: hidden;
        }

        .loading-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 18px;
        }

        .loading-logo::after {
            content: '‚óâ';
            animation: winkEye 4s ease-in-out infinite;
        }

        .loading-logo.has-image::after {
            display: none;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .loading-text {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .loading-subtitle {
            opacity: 0.8;
            font-size: 16px;
            margin-bottom: 2rem;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: white;
            border-radius: 2px;
            animation: loading 2s ease-out;
        }

        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* Debug Info */
        .debug-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #1e293b;
            color: #22c55e;
            padding: 1rem;
            border-radius: 8px;
            font-size: 12px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            display: none;
            max-width: 300px;
            border: 1px solid #334155;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .debug-info.show {
            display: block;
        }

        .debug-info div {
            margin: 2px 0;
            opacity: 0.9;
        }

        /* Sistema de Pesta√±as Contextuales */
        .tabs-container {
            margin-top: 2rem;
        }

        .tabs-header {
            display: flex;
            gap: 0;
            border-bottom: 1px solid var(--border-color);
            background: var(--card-bg);
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
            padding: 0 2rem;
            overflow-x: auto;
        }

        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 14px;
            white-space: nowrap;
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tab:hover {
            color: var(--primary-green);
            background: var(--hover-bg);
        }

        .tab.active {
            color: var(--primary-green);
            background: var(--hover-bg);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--primary-green);
        }

        .tabs-content {
            background: var(--card-bg);
            border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
            border: 1px solid var(--border-color);
            border-top: none;
            min-height: 400px;
        }

        .tab-pane {
            padding: 2rem;
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .tab-pane h3 {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }

        .tab-pane p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        /* Contenido espec√≠fico de pesta√±as */
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .content-card {
            background: var(--hover-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .content-card:hover {
            background: var(--card-bg);
            box-shadow: var(--shadow-sm);
        }

        .content-card h4 {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .content-card p {
            color: var(--text-secondary);
            font-size: 14px;
            margin: 0;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary-green);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-green-hover);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--hover-bg);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-success {
            background: var(--primary-green);
            color: white;
        }

        .btn-success:hover {
            background: var(--primary-green-hover);
            transform: translateY(-1px);
        }

        /* Role selector para debug */
        .role-selector {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--card-bg);
            margin-right: 1rem;
            font-size: 14px;
            color: var(--text-primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header-actions {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body data-theme="light">
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-logo" id="loadingLogo"></div>
        <div class="loading-text" id="loadingCompanyName">Opsis Suite</div>
        <div class="loading-subtitle" id="loadingSubtitle">Iniciando Dashboard...</div>
        <div class="loading-progress">
            <div class="progress-bar"></div>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="logo-container">
                    <div class="logo-icon" id="headerLogo"></div>
                </div>
                <div class="header-info">
                    <h1 id="companyName">Dashboard</h1>
                    <p id="companyDescription">Warehouse Management System</p>
                    <!-- M√≥dulos del ecosistema -->
                    <div class="ecosystem-modules" style="display: flex; gap: 0.5rem; margin-top: 0.75rem;">
                        <span class="current-module" style="background: var(--primary-green); color: white; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.75rem; font-weight: 600;">
                            üì¶ WAREHOUSE
                        </span>
                        <a href="https://candewesth.github.io/opsis-suite/built.html?module=hr" class="module-link" style="background: var(--hover-bg); color: var(--text-secondary); padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.75rem; font-weight: 500; text-decoration: none; transition: all 0.2s ease;" 
                           onmouseover="this.style.background='#8b5cf6'; this.style.color='white'" onmouseout="this.style.background='var(--hover-bg)'; this.style.color='var(--text-secondary)'">
                            üë• HR
                        </a>
                        <a href="https://candewesth.github.io/opsis-suite/built.html?module=timesync" class="module-link" style="background: var(--hover-bg); color: var(--text-secondary); padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.75rem; font-weight: 500; text-decoration: none; transition: all 0.2s ease;"
                           onmouseover="this.style.background='#f59e0b'; this.style.color='white'" onmouseout="this.style.background='var(--hover-bg)'; this.style.color='var(--text-secondary)'">
                            ‚è±Ô∏è TIMESYNC
                        </a>
                        <a href="https://candewesth.github.io/opsis-suite/built.html?module=finance" class="module-link" style="background: var(--hover-bg); color: var(--text-secondary); padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.75rem; font-weight: 500; text-decoration: none; transition: all 0.2s ease;"
                           onmouseover="this.style.background='#3b82f6'; this.style.color='white'" onmouseout="this.style.background='var(--hover-bg)'; this.style.color='var(--text-secondary)'">
                            üí∞ FINANCE
                        </a>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <!-- Role selector en modo debug -->
                <div id="debugControls" style="display: none;">
                    <select class="role-selector" id="roleSelector">
                        <option value="almacen">ALMAC√âN</option>
                        <option value="operativo">OPERATIVO</option>
                        <option value="estimador">ESTIMADOR</option>
                        <option value="supervisor">SUPERVISOR</option>
                        <option value="admin">ADMIN</option>
                    </select>
                </div>
                <div class="profile-info">
                    <div class="profile-name" id="profileName">Usuario Demo</div>
                    <div class="profile-role" id="profileRole">Almac√©n</div>
                </div>
                <button class="logout-btn" onclick="handleSignOut()">Salir</button>
            </div>
        </div>

        <!-- Stats Overview -->
        <div class="stats-grid" id="statsGrid">
            <!-- Widgets se cargar√°n din√°micamente seg√∫n el rol -->
        </div>

        <!-- Sistema de Pesta√±as Contextuales -->
        <div class="tabs-container" id="tabsContainer">
            <div class="tabs-header" id="tabsHeader">
                <!-- Pesta√±as se generan din√°micamente -->
            </div>
            <div class="tabs-content" id="tabsContent">
                <!-- Contenido de pesta√±as se carga din√°micamente -->
            </div>
        </div>
    </div>

    <!-- Debug Info -->
    <div id="debugInfo" class="debug-info"></div>

    <script>
        // ================================================================
        // VARIABLES GLOBALES
        // ================================================================
        
        let currentRole = 'ALMACEN';
        let currentCompany = null;
        let isDebugMode = false;

        // ================================================================
        // FUNCIONES DE UTILIDAD (DEFINIDAS PRIMERO)
        // ================================================================

        function log(message) {
            console.log(`[Dashboard] ${message}`);
            
            if (isDebugMode) {
                const debugElement = document.getElementById('debugInfo');
                if (debugElement) {
                    debugElement.classList.add('show');
                    const time = new Date().toLocaleTimeString();
                    const div = document.createElement('div');
                    div.textContent = `[${time}] ${message}`;
                    debugElement.appendChild(div);
                    
                    // Mantener solo las √∫ltimas 8 l√≠neas
                    while (debugElement.children.length > 8) {
                        debugElement.removeChild(debugElement.firstChild);
                    }
                }
            }
        }

        function detectDebugMode() {
            return window.location.search.includes('debug=true');
        }

        function detectRole() {
            const urlParams = new URLSearchParams(window.location.search);
            const roleParam = urlParams.get('role');
            return roleParam ? roleParam.toUpperCase() : 'ALMACEN';
        }

        function detectCompany() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('company') || 'demo';
        }

        // ================================================================
        // CONFIGURACI√ìN DE ROLES Y CONTENIDO
        // ================================================================

        const ROLES_CONFIG = {
            ADMIN: {
                title: 'Panel de Administraci√≥n',
                subtitle: 'Control total de la empresa y configuraciones del sistema',
                widgets: [
                    { icon: 'üë•', title: 'Total Users', number: '0', label: 'Active team members' },
                    { icon: 'üí∞', title: 'Monthly Revenue', number: '$0', label: 'Current billing cycle' },
                    { icon: '‚öôÔ∏è', title: 'System Health', number: '0%', label: 'All systems operational' },
                    { icon: 'üìã', title: 'Plan Status', number: 'Free', label: 'Current plan active' }
                ],
                tabs: [
                    { id: 'admin-users', label: 'Usuarios', icon: 'üë•' },
                    { id: 'admin-companies', label: 'Empresas', icon: 'üè¢' },
                    { id: 'admin-billing', label: 'Facturaci√≥n', icon: 'üí≥' },
                    { id: 'admin-settings', label: 'Configuraci√≥n', icon: '‚öôÔ∏è' }
                ]
            },
            ALMACEN: {
                title: 'Gesti√≥n de Equipos y Log√≠stica',
                subtitle: 'Control integral de inventario, distribuci√≥n y ciclo de vida de equipos',
                widgets: [
                    { icon: 'üì¶', title: 'Inventario Total', number: '0', label: 'Equipos gestionados' },
                    { icon: 'üöõ', title: 'En Campo', number: '0', label: 'Equipos desplegados' },
                    { icon: 'üîÑ', title: 'Operaciones Hoy', number: '0', label: 'Check-in/out realizados' },
                    { icon: 'üîß', title: 'Mantenimiento', number: '0', label: 'Equipos programados' }
                ],
                tabs: [
                    { id: 'inventory', label: 'Inventario', icon: 'üì¶' },
                    { id: 'distribution', label: 'Distribuci√≥n', icon: 'üöõ' },
                    { id: 'maintenance', label: 'Mantenimiento', icon: 'üîß' },
                    { id: 'reports', label: 'Reportes', icon: 'üìä' }
                ]
            },
            OPERATIVO: {
                title: 'Panel Operativo',
                subtitle: 'Check-in/out y gesti√≥n de campo',
                widgets: [
                    { icon: 'üéØ', title: 'Mis Equipos', number: '0', label: 'Actualmente asignados' },
                    { icon: '‚ö°', title: 'Acciones R√°pidas', number: '0', label: 'Check-outs pendientes' },
                    { icon: 'üö®', title: 'Incidencias', number: '0', label: 'Requieren atenci√≥n' },
                    { icon: 'üìÖ', title: 'Cronograma Hoy', number: '0', label: 'Tareas programadas' }
                ],
                tabs: [
                    { id: 'my-equipment', label: 'Mis Equipos', icon: 'üéØ' },
                    { id: 'checkout', label: 'Check-in/out', icon: '‚ö°' },
                    { id: 'incidents', label: 'Incidencias', icon: 'üö®' },
                    { id: 'schedule', label: 'Horario', icon: 'üìÖ' }
                ]
            },
            ESTIMADOR: {
                title: 'Mesa de Estimaciones',
                subtitle: 'Cotizaciones, proyectos y an√°lisis de costos',
                widgets: [
                    { icon: 'üèóÔ∏è', title: 'Proyectos Activos', number: '0', label: 'En progreso' },
                    { icon: 'üìä', title: 'Cotizaciones', number: '0', label: 'Esperando aprobaci√≥n' },
                    { icon: 'üíµ', title: 'An√°lisis de Costos', number: '$0', label: 'Costo mensual equipos' },
                    { icon: 'üìà', title: 'Margen', number: '0%', label: 'Trimestre actual' }
                ],
                tabs: [
                    { id: 'projects', label: 'Proyectos', icon: 'üèóÔ∏è' },
                    { id: 'quotes', label: 'Cotizaciones', icon: 'üìä' },
                    { id: 'costs', label: 'Costos', icon: 'üíµ' },
                    { id: 'calculator', label: 'Calculadora', icon: 'üßÆ' }
                ]
            },
            SUPERVISOR: {
                title: 'Control de Campo',
                subtitle: 'Supervisi√≥n de equipos y productividad',
                widgets: [
                    { icon: 'üöõ', title: 'Equipos en Campo', number: '0', label: 'En sitios activos' },
                    { icon: '‚≠ê', title: 'Eficiencia del Equipo', number: '0%', label: 'Promedio semanal' },
                    { icon: 'üéØ', title: 'Sitios Supervisados', number: '0', label: 'Ubicaciones activas' },
                    { icon: 'üîî', title: 'Alertas de Campo', number: '0', label: 'Requieren respuesta' }
                ],
                tabs: [
                    { id: 'field', label: 'Campo', icon: 'üöõ' },
                    { id: 'team', label: 'Equipo', icon: 'üë•' },
                    { id: 'productivity', label: 'Productividad', icon: 'üìà' },
                    { id: 'assignments', label: 'Asignaciones', icon: 'üéØ' }
                ]
            }
        };

        const TAB_CONTENT = {
            // ADMIN tabs
            'admin-users': {
                title: 'Gesti√≥n de Usuarios',
                description: 'Administrar usuarios del sistema y asignar roles',
                content: [
                    { title: 'Usuarios Activos', desc: '0 usuarios registrados en el sistema' },
                    { title: 'Roles y Permisos', desc: 'Configurar niveles de acceso por rol' },
                    { title: 'Invitaciones Pendientes', desc: '0 invitaciones enviadas' },
                    { title: '√öltimas Conexiones', desc: 'Monitoreo de actividad de usuarios' }
                ],
                actions: ['Nuevo Usuario', 'Gestionar Roles', 'Exportar Lista', 'Configurar Permisos']
            },
            'admin-companies': {
                title: 'Configuraci√≥n Empresarial',
                description: 'Administrar configuraci√≥n de la empresa y m√≥dulos',
                content: [
                    { title: 'Informaci√≥n General', desc: 'Datos corporativos y contacto' },
                    { title: 'M√≥dulos Activos', desc: 'Warehouse, HR, TimeSync, Finance' },
                    { title: 'Pol√≠ticas y Reglas', desc: 'Configuraciones espec√≠ficas del negocio' },
                    { title: 'Integraciones', desc: 'APIs y sistemas externos conectados' }
                ],
                actions: ['Editar Empresa', 'Activar M√≥dulos', 'Configurar Pol√≠ticas', 'Ver Integraciones']
            },

            // ALMACEN tabs expandidas
            'inventory': {
                title: 'Control de Inventario Avanzado',
                description: 'Gesti√≥n completa del inventario con c√≥digos QR y geolocalizaci√≥n',
                content: [
                    { title: 'Equipos Disponibles', desc: '0 equipos listos para pr√©stamo con c√≥digos QR' },
                    { title: 'Equipos en Campo', desc: '0 equipos con seguimiento GPS en tiempo real' },
                    { title: 'Alertas de Stock', desc: '0 equipos necesitan reabastecimiento autom√°tico' },
                    { title: 'Mantenimiento Predictivo', desc: 'IA predice necesidades de mantenimiento' },
                    { title: 'An√°lisis de Calidad', desc: 'M√©tricas de performance y durabilidad' },
                    { title: 'Warehouse Analytics', desc: 'Optimizaci√≥n de espacios y rutas internas' }
                ],
                actions: ['Agregar Equipo', 'Escanear QR', 'Ver Mapa GPS', 'Generar Alertas', 'An√°lisis IA', 'Optimizar Layout']
            },
            'distribution': {
                title: 'Centro de Distribuci√≥n Inteligente',
                description: 'Control de entregas con optimizaci√≥n de rutas y seguimiento en tiempo real',
                content: [
                    { title: 'Entregas Programadas', desc: '0 entregas con rutas optimizadas por IA' },
                    { title: 'Retornos Esperados', desc: '0 equipos con cronograma autom√°tico' },
                    { title: 'Rutas Optimizadas', desc: 'Algoritmo reduce tiempo y costos de transporte' },
                    { title: 'Conductores y Veh√≠culos', desc: 'Gesti√≥n de flota y asignaci√≥n inteligente' },
                    { title: 'Confirmaciones Digitales', desc: 'Firmas electr√≥nicas y fotos de entrega' },
                    { title: 'An√°lisis de Performance', desc: 'KPIs de entrega y satisfacci√≥n del cliente' }
                ],
                actions: ['Planificar Ruta', 'Asignar Conductor', 'Seguimiento Live', 'Confirmar Entrega', 'Generar POD', 'Ver Analytics']
            },
            'maintenance': {
                title: 'Mantenimiento Predictivo e Inteligente',
                description: 'Sistema avanzado de mantenimiento con IA y an√°lisis predictivo',
                content: [
                    { title: 'Mantenimiento Predictivo', desc: 'IA predice fallas antes de que ocurran' },
                    { title: 'Cronograma Autom√°tico', desc: '0 equipos programados seg√∫n algoritmos' },
                    { title: 'Historial Completo', desc: 'Registro detallado por equipo con c√≥digos QR' },
                    { title: 'Alertas Inteligentes', desc: 'Notificaciones proactivas por condici√≥n' },
                    { title: 'Proveedores de Servicio', desc: 'Red de t√©cnicos certificados por zona' },
                    { title: 'An√°lisis de Costos', desc: 'ROI del mantenimiento preventivo vs correctivo' }
                ],
                actions: ['Programar IA', 'Crear Orden', 'Asignar T√©cnico', 'Verificar Estado', 'Generar Reporte', 'Optimizar Costos']
            },
            'reports': {
                title: 'Reportes y Analytics Avanzados',
                description: 'Business Intelligence espec√≠fico para operaciones de construcci√≥n',
                content: [
                    { title: 'Dashboard Ejecutivo', desc: 'KPIs en tiempo real para directivos' },
                    { title: 'An√°lisis de Rentabilidad', desc: 'ROI por equipo, proyecto y per√≠odo' },
                    { title: 'Productividad de Equipos', desc: 'Utilizaci√≥n, tiempo muerto, eficiencia' },
                    { title: 'Predicciones de Demanda', desc: 'IA predice necesidades futuras de equipos' },
                    { title: 'Benchmarking', desc: 'Comparativas con est√°ndares de la industria' },
                    { title: 'Reportes Regulatorios', desc: 'Cumplimiento autom√°tico de normativas' }
                ],
                actions: ['Dashboard Live', 'An√°lisis ROI', 'Predicciones IA', 'Export PDF', 'Configurar Alertas', 'Benchmark']
            },

            // OPERATIVO tabs expandidas
            'my-equipment': {
                title: 'Mis Equipos con Seguimiento GPS',
                description: 'Gesti√≥n personal de equipos asignados con tecnolog√≠a m√≥vil',
                content: [
                    { title: 'Equipos Asignados', desc: '0 equipos bajo mi responsabilidad con GPS' },
                    { title: 'Estado en Tiempo Real', desc: 'Ubicaci√≥n, condici√≥n y uso actual' },
                    { title: 'Pr√≥ximas Entregas', desc: '0 equipos programados para entrega' },
                    { title: 'Check-in/out M√≥vil', desc: 'App m√≥vil con c√≥digos QR y GPS' },
                    { title: 'Reportes de Campo', desc: 'Fotos, incidencias y estado desde m√≥vil' },
                    { title: 'Timesheet Autom√°tico', desc: 'Registro autom√°tico de horas trabajadas' }
                ],
                actions: ['Ver en Mapa', 'Escanear QR', 'Check-out', 'Reportar Estado', 'Subir Fotos', 'Ver Timesheet']
            },
            'checkout': {
                title: 'Sistema de Check-in/out Avanzado',
                description: 'Proceso digital completo con validaciones y confirmaciones',
                content: [
                    { title: 'Check-out R√°pido', desc: '0 equipos listos con validaci√≥n autom√°tica' },
                    { title: 'Validaciones GPS', desc: 'Confirmaci√≥n de ubicaci√≥n en check-in/out' },
                    { title: 'Firmas Digitales', desc: 'Confirmaci√≥n legal de responsabilidad' },
                    { title: 'Fotos de Condici√≥n', desc: 'Registro visual antes y despu√©s del uso' },
                    { title: 'Historial Completo', desc: 'Trazabilidad total de movimientos' },
                    { title: 'Alertas de Vencimiento', desc: 'Notificaciones autom√°ticas de devoluci√≥n' }
                ],
                actions: ['Check-out GPS', 'Firmar Digital', 'Tomar Fotos', 'Confirmar Estado', 'Ver Historial', 'Alertas Push']
            },

            // ESTIMADOR tabs expandidas
            'projects': {
                title: 'Gesti√≥n Inteligente de Proyectos',
                description: 'Planificaci√≥n de proyectos con IA y an√°lisis predictivo de costos',
                content: [
                    { title: 'Proyectos Activos', desc: '0 proyectos con timeline inteligente' },
                    { title: 'Planificaci√≥n con IA', desc: 'Algoritmos optimizan recursos y cronogramas' },
                    { title: 'Base de Datos Hist√≥rica', desc: 'Costos y tiempos de proyectos similares' },
                    { title: 'An√°lisis de Riesgos', desc: 'IA identifica posibles desviaciones' },
                    { title: 'Colaboraci√≥n en Tiempo Real', desc: 'Equipos multidisciplinarios conectados' },
                    { title: 'Control de Cambios', desc: 'Gesti√≥n de modificaciones y su impacto' }
                ],
                actions: ['Nuevo Proyecto', 'Planificar IA', 'An√°lisis Riesgo', 'Colaborar', 'Control Cambios', 'Timeline']
            },
            'quotes': {
                title: 'Generador de Cotizaciones Inteligente',
                description: 'Sistema automatizado de cotizaciones con precios din√°micos',
                content: [
                    { title: 'Cotizaciones Activas', desc: '0 propuestas con pricing inteligente' },
                    { title: 'Precios Din√°micos', desc: 'Algoritmos ajustan precios seg√∫n mercado' },
                    { title: 'Templates Avanzados', desc: 'Plantillas personalizables por tipo de proyecto' },
                    { title: 'An√°lisis de Competencia', desc: 'IA compara con precios del mercado' },
                    { title: 'Generaci√≥n Autom√°tica', desc: 'PDFs profesionales con un click' },
                    { title: 'Seguimiento de Conversi√≥n', desc: 'Analytics de propuestas ganadoras' }
                ],
                actions: ['Nueva Cotizaci√≥n', 'Pricing IA', 'Templates', 'An√°lisis Mercado', 'Generar PDF', 'Ver Analytics']
            },

            // SUPERVISOR tabs expandidas
            'field': {
                title: 'Supervisi√≥n de Campo en Tiempo Real',
                description: 'Control total de operaciones de campo con tecnolog√≠a IoT',
                content: [
                    { title: 'Equipos en Campo', desc: '0 equipos con telemetr√≠a en tiempo real' },
                    { title: 'Monitoreo IoT', desc: 'Sensores reportan ubicaci√≥n y condici√≥n' },
                    { title: 'Geofencing Inteligente', desc: 'Alertas autom√°ticas por zonas restringidas' },
                    { title: 'Dashboard de Campo', desc: 'Vista unified de todas las operaciones' },
                    { title: 'Alertas Proactivas', desc: 'IA predice problemas antes de que ocurran' },
                    { title: 'Comunicaci√≥n Directa', desc: 'Chat y video llamadas con operarios' }
                ],
                actions: ['Ver Dashboard', 'Configurar Geofence', 'Alertas IA', 'Chat Equipos', 'Inspecci√≥n Remote', 'Generar Reporte']
            },
            'team': {
                title: 'Gesti√≥n Avanzada del Equipo',
                description: 'Productividad y performance del equipo con analytics avanzados',
                content: [
                    { title: 'Performance Individual', desc: 'M√©tricas detalladas por operario' },
                    { title: 'Asignaci√≥n Inteligente', desc: 'IA optimiza asignaci√≥n de tareas' },
                    { title: 'Capacitaci√≥n y Certificaci√≥n', desc: 'Tracking de skills y entrenamientos' },
                    { title: 'Evaluaciones 360¬∞', desc: 'Feedback multidireccional del equipo' },
                    { title: 'Incentivos y Reconocimientos', desc: 'Sistema gamificado de recompensas' },
                    { title: 'An√°lisis Predictivo', desc: 'Predicci√≥n de rotaci√≥n y satisfacci√≥n' }
                ],
                actions: ['Ver Performance', 'Asignar IA', 'Planificar Training', 'Evaluaci√≥n 360', 'Sistema Incentivos', 'Predictive Analytics']
            }
        };

        // ================================================================
        // FUNCIONES DE INTERFAZ
        // ================================================================

        function updateWidgets(role) {
            const config = ROLES_CONFIG[role];
            if (!config) return;

            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = '';

            config.widgets.forEach((widget, index) => {
                const card = document.createElement('div');
                card.className = 'stat-card';
                
                // Determinar clase del icono seg√∫n el √≠ndice
                let iconClass = '';
                switch(index) {
                    case 0: iconClass = 'companies'; break;
                    case 1: iconClass = 'users'; break;
                    case 2: iconClass = 'revenue'; break;
                    case 3: iconClass = 'activity'; break;
                }
                
                card.innerHTML = `
                    <div class="stat-header">
                        <div class="stat-icon ${iconClass}">${widget.icon}</div>
                        <div class="stat-trend up">‚Üó +0%</div>
                    </div>
                    <div class="stat-title">${widget.title}</div>
                    <div class="stat-value">${widget.number}</div>
                    <div class="stat-description">${widget.label}</div>
                `;
                statsGrid.appendChild(card);
            });

            log(`Widgets updated for role: ${role}`);
        }

        function createTabs(role) {
            const config = ROLES_CONFIG[role];
            if (!config) return;

            const tabsHeader = document.getElementById('tabsHeader');
            const tabsContent = document.getElementById('tabsContent');
            
            // Limpiar contenido existente
            tabsHeader.innerHTML = '';
            tabsContent.innerHTML = '';
            
            // Crear pesta√±as
            config.tabs.forEach((tab, index) => {
                // Crear bot√≥n de pesta√±a
                const tabButton = document.createElement('button');
                tabButton.className = `tab ${index === 0 ? 'active' : ''}`;
                tabButton.innerHTML = `${tab.icon} ${tab.label}`;
                tabButton.onclick = () => switchTab(tab.id, tabButton);
                tabsHeader.appendChild(tabButton);
                
                // Crear contenido de pesta√±a
                const tabPane = document.createElement('div');
                tabPane.className = `tab-pane ${index === 0 ? 'active' : ''}`;
                tabPane.id = tab.id;
                
                const content = TAB_CONTENT[tab.id];
                if (content) {
                    tabPane.innerHTML = `
                        <h3>${content.title}</h3>
                        <p>${content.description}</p>
                        <div class="content-grid">
                            ${content.content.map(item => `
                                <div class="content-card">
                                    <h4>${item.title}</h4>
                                    <p>${item.desc}</p>
                                </div>
                            `).join('')}
                        </div>
                        <div class="action-buttons">
                            ${content.actions.map(action => `
                                <button class="btn btn-primary" onclick="handleAction('${action}')">${action}</button>
                            `).join('')}
                        </div>
                    `;
                } else {
                    tabPane.innerHTML = `
                        <h3>${tab.label}</h3>
                        <p>Contenido de ${tab.label} en desarrollo</p>
                        <div class="content-grid">
                            <div class="content-card">
                                <h4>Funcionalidad pr√≥ximamente</h4>
                                <p>Esta secci√≥n estar√° disponible en futuras actualizaciones</p>
                            </div>
                        </div>
                    `;
                }
                
                tabsContent.appendChild(tabPane);
            });

            log(`Tabs created for role: ${role}`);
        }

        function switchTab(tabId, clickedButton) {
            // Actualizar botones de pesta√±as
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            clickedButton.classList.add('active');
            
            // Actualizar contenido de pesta√±as
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            const targetPane = document.getElementById(tabId);
            if (targetPane) {
                targetPane.classList.add('active');
            }
            
            log(`Switched to tab: ${tabId}`);
        }

        function updateHeader(role) {
            const config = ROLES_CONFIG[role];
            if (!config) return;

            document.getElementById('companyName').textContent = config.title;
            document.getElementById('companyDescription').textContent = config.subtitle;
            document.getElementById('profileRole').textContent = role;

            log(`Header updated for role: ${role}`);
        }

        function setupDebugControls() {
            if (!isDebugMode) return;

            const debugControls = document.getElementById('debugControls');
            const roleSelector = document.getElementById('roleSelector');
            
            debugControls.style.display = 'block';
            roleSelector.value = currentRole.toLowerCase();
            
            roleSelector.onchange = (e) => {
                const newRole = e.target.value.toUpperCase();
                changeRole(newRole);
            };

            log('Debug controls setup completed');
        }

        function changeRole(newRole) {
            currentRole = newRole;
            updateHeader(newRole);
            updateWidgets(newRole);
            createTabs(newRole);
            log(`Role changed to: ${newRole}`);
        }

        // ================================================================
        // FUNCIONES DE EVENTOS
        // ================================================================

        function handleAction(action) {
            log(`Action triggered: ${action}`);
            alert(`Acci√≥n: ${action}\nEsta funcionalidad estar√° disponible pr√≥ximamente.`);
        }

        function handleSignOut() {
            log('Sign out clicked');
            if (confirm('¬øEst√°s seguro que deseas cerrar sesi√≥n?')) {
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 500);
            }
        }

        // ================================================================
        // INICIALIZACI√ìN
        // ================================================================

        function init() {
            try {
                log('Initializing dashboard');

                // Detectar configuraciones
                isDebugMode = detectDebugMode();
                currentRole = detectRole();
                const company = detectCompany();

                log(`Debug mode: ${isDebugMode}`);
                log(`Role detected: ${currentRole}`);
                log(`Company: ${company}`);

                // Configurar interfaz
                updateHeader(currentRole);
                updateWidgets(currentRole);
                createTabs(currentRole);
                setupDebugControls();

                // Actualizar loading screen
                const config = ROLES_CONFIG[currentRole];
                if (config) {
                    document.getElementById('loadingCompanyName').textContent = config.title;
                    document.getElementById('loadingSubtitle').textContent = `Iniciando ${config.subtitle.toLowerCase()}...`;
                }

                // Ocultar loading screen
                setTimeout(() => {
                    document.getElementById('loadingScreen').classList.add('hidden');
                    log('Dashboard initialization completed successfully');
                }, 1500);

            } catch (error) {
                log(`Initialization error: ${error.message}`);
                console.error('Dashboard initialization failed:', error);
            }
        }

        // ================================================================
        // EVENT LISTENERS
        // ================================================================

        document.addEventListener('DOMContentLoaded', init);

        // Atajos de teclado para debug
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                const debugInfo = document.getElementById('debugInfo');
                if (debugInfo.classList.contains('show')) {
                    debugInfo.classList.remove('show');
                } else {
                    debugInfo.classList.add('show');
                    isDebugMode = true;
                }
            }
        });

        log('Dashboard script loaded');
    </script>
</body>
</html>
